
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../day2/">
      
      
        <link rel="next" href="../day4_new/">
      
      
      <link rel="icon" href="../assets/images/SIB_logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Day3-Mixed Effect Models - Advanced statistics</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mixed-effects-linear-models-and-longitudinal-data-analysis" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Advanced statistics" class="md-header__button md-logo" aria-label="Advanced statistics" data-md-component="logo">
      
  <img src="../assets/images/SIB_logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Advanced statistics
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Day3-Mixed Effect Models
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/sib-swiss/advanced-statistics" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    sib-swiss/advanced-statistics
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Advanced statistics" class="md-nav__button md-logo" aria-label="Advanced statistics" data-md-component="logo">
      
  <img src="../assets/images/SIB_logo.svg" alt="logo">

    </a>
    Advanced statistics
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sib-swiss/advanced-statistics" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    sib-swiss/advanced-statistics
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../precourse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Precourse preparation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../course_schedule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Course schedule
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../day1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Day1-Linear Regression and Beyond
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../day2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Day2-GLM
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Day3-Mixed Effect Models
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Day3-Mixed Effect Models
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tolerance-data-set" class="md-nav__link">
    <span class="md-ellipsis">
      Tolerance data set
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tolerance data set">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#perform-a-graphical-exploration-of-the-data" class="md-nav__link">
    <span class="md-ellipsis">
      Perform a graphical exploration of the data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analysis-of-individual-change-over-time" class="md-nav__link">
    <span class="md-ellipsis">
      Analysis of individual change over time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analysis of individual change over time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#non-parametric-smoothing-spline-fit" class="md-nav__link">
    <span class="md-ellipsis">
      Non-parametric smoothing spline fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nonparametric-loess-fit" class="md-nav__link">
    <span class="md-ellipsis">
      Nonparametric loess fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parametriclinear-fit" class="md-nav__link">
    <span class="md-ellipsis">
      Parametric/linear fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#individual-linear-fits" class="md-nav__link">
    <span class="md-ellipsis">
      Individual linear fits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analysis-of-inter-individual-differences" class="md-nav__link">
    <span class="md-ellipsis">
      Analysis of inter-individual differences
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analysis of inter-individual differences">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#average-of-the-curves-nonparametric" class="md-nav__link">
    <span class="md-ellipsis">
      Average of the curves (nonparametric)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#average-of-the-curves-parametric" class="md-nav__link">
    <span class="md-ellipsis">
      Average of the curves (parametric)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intercepts-and-slopes-from-linear-fit" class="md-nav__link">
    <span class="md-ellipsis">
      Intercepts and slopes from linear fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stratify-based-on-covariates" class="md-nav__link">
    <span class="md-ellipsis">
      Stratify based on covariates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#corn-data" class="md-nav__link">
    <span class="md-ellipsis">
      Corn Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Corn Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-exploration-of-harvwt" class="md-nav__link">
    <span class="md-ellipsis">
      Data Exploration of harvwt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-modelling-with-fixed-and-random-effects" class="md-nav__link">
    <span class="md-ellipsis">
      Data modelling with fixed and random effects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-data-exploration-of-ear" class="md-nav__link">
    <span class="md-ellipsis">
      1. Data exploration of ear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-fit-a-random-effects-model" class="md-nav__link">
    <span class="md-ellipsis">
      2. Fit a random effects model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-model-assumptions" class="md-nav__link">
    <span class="md-ellipsis">
      3. Model assumptions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tolerance-data-set2" class="md-nav__link">
    <span class="md-ellipsis">
      Tolerance data set2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tolerance data set2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-level-mixed-effects-modeling" class="md-nav__link">
    <span class="md-ellipsis">
      multi-level / mixed-effects modeling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-1st-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 1st model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-2nd-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 2nd model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-3rd-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 3rd model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-4th-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 4th model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-5th-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 5th model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-6th-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 6th model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-7th-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 7th model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-8th-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 8th model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-9th-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 9th model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-10th-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 10th model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btheb-data-set" class="md-nav__link">
    <span class="md-ellipsis">
      BtheB data set
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BtheB data set">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploratory-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Exploratory analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-fittingselection" class="md-nav__link">
    <span class="md-ellipsis">
      Model fitting/selection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bone-data-set" class="md-nav__link">
    <span class="md-ellipsis">
      Bone data set
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bone data set">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploratory-analysis_1" class="md-nav__link">
    <span class="md-ellipsis">
      Exploratory analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parametriclinear-fit_1" class="md-nav__link">
    <span class="md-ellipsis">
      Parametric/linear fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare-the-trends-for-male-and-females" class="md-nav__link">
    <span class="md-ellipsis">
      Compare the trends for male and females
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-cubic-splines" class="md-nav__link">
    <span class="md-ellipsis">
      Using cubic splines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-fittingselection_1" class="md-nav__link">
    <span class="md-ellipsis">
      Model fitting/selection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rat-brain-data" class="md-nav__link">
    <span class="md-ellipsis">
      Rat Brain Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rat Brain Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-exploration-of-the-data" class="md-nav__link">
    <span class="md-ellipsis">
      1. Exploration of the data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-model-fitting" class="md-nav__link">
    <span class="md-ellipsis">
      2. Model fitting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-add-random-effects" class="md-nav__link">
    <span class="md-ellipsis">
      3. Add random effects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-compare-using-lr" class="md-nav__link">
    <span class="md-ellipsis">
      4. Compare using LR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-model-assumptions" class="md-nav__link">
    <span class="md-ellipsis">
      5. Model assumptions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../day4_new/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Day4-Caret
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../day4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bonus exercice
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../exam/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exam
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../links/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Useful links
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tolerance-data-set" class="md-nav__link">
    <span class="md-ellipsis">
      Tolerance data set
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tolerance data set">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#perform-a-graphical-exploration-of-the-data" class="md-nav__link">
    <span class="md-ellipsis">
      Perform a graphical exploration of the data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analysis-of-individual-change-over-time" class="md-nav__link">
    <span class="md-ellipsis">
      Analysis of individual change over time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analysis of individual change over time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#non-parametric-smoothing-spline-fit" class="md-nav__link">
    <span class="md-ellipsis">
      Non-parametric smoothing spline fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nonparametric-loess-fit" class="md-nav__link">
    <span class="md-ellipsis">
      Nonparametric loess fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parametriclinear-fit" class="md-nav__link">
    <span class="md-ellipsis">
      Parametric/linear fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#individual-linear-fits" class="md-nav__link">
    <span class="md-ellipsis">
      Individual linear fits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analysis-of-inter-individual-differences" class="md-nav__link">
    <span class="md-ellipsis">
      Analysis of inter-individual differences
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analysis of inter-individual differences">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#average-of-the-curves-nonparametric" class="md-nav__link">
    <span class="md-ellipsis">
      Average of the curves (nonparametric)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#average-of-the-curves-parametric" class="md-nav__link">
    <span class="md-ellipsis">
      Average of the curves (parametric)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intercepts-and-slopes-from-linear-fit" class="md-nav__link">
    <span class="md-ellipsis">
      Intercepts and slopes from linear fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stratify-based-on-covariates" class="md-nav__link">
    <span class="md-ellipsis">
      Stratify based on covariates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#corn-data" class="md-nav__link">
    <span class="md-ellipsis">
      Corn Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Corn Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-exploration-of-harvwt" class="md-nav__link">
    <span class="md-ellipsis">
      Data Exploration of harvwt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-modelling-with-fixed-and-random-effects" class="md-nav__link">
    <span class="md-ellipsis">
      Data modelling with fixed and random effects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-data-exploration-of-ear" class="md-nav__link">
    <span class="md-ellipsis">
      1. Data exploration of ear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-fit-a-random-effects-model" class="md-nav__link">
    <span class="md-ellipsis">
      2. Fit a random effects model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-model-assumptions" class="md-nav__link">
    <span class="md-ellipsis">
      3. Model assumptions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tolerance-data-set2" class="md-nav__link">
    <span class="md-ellipsis">
      Tolerance data set2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tolerance data set2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-level-mixed-effects-modeling" class="md-nav__link">
    <span class="md-ellipsis">
      multi-level / mixed-effects modeling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-1st-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 1st model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-2nd-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 2nd model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-3rd-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 3rd model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-4th-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 4th model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-5th-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 5th model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-6th-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 6th model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-7th-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 7th model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-8th-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 8th model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-9th-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 9th model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fit-the-10th-model" class="md-nav__link">
    <span class="md-ellipsis">
      Fit the 10th model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#btheb-data-set" class="md-nav__link">
    <span class="md-ellipsis">
      BtheB data set
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BtheB data set">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploratory-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Exploratory analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-fittingselection" class="md-nav__link">
    <span class="md-ellipsis">
      Model fitting/selection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bone-data-set" class="md-nav__link">
    <span class="md-ellipsis">
      Bone data set
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bone data set">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploratory-analysis_1" class="md-nav__link">
    <span class="md-ellipsis">
      Exploratory analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parametriclinear-fit_1" class="md-nav__link">
    <span class="md-ellipsis">
      Parametric/linear fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compare-the-trends-for-male-and-females" class="md-nav__link">
    <span class="md-ellipsis">
      Compare the trends for male and females
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-cubic-splines" class="md-nav__link">
    <span class="md-ellipsis">
      Using cubic splines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-fittingselection_1" class="md-nav__link">
    <span class="md-ellipsis">
      Model fitting/selection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rat-brain-data" class="md-nav__link">
    <span class="md-ellipsis">
      Rat Brain Data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rat Brain Data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-exploration-of-the-data" class="md-nav__link">
    <span class="md-ellipsis">
      1. Exploration of the data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-model-fitting" class="md-nav__link">
    <span class="md-ellipsis">
      2. Model fitting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-add-random-effects" class="md-nav__link">
    <span class="md-ellipsis">
      3. Add random effects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-compare-using-lr" class="md-nav__link">
    <span class="md-ellipsis">
      4. Compare using LR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-model-assumptions" class="md-nav__link">
    <span class="md-ellipsis">
      5. Model assumptions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="mixed-effects-linear-models-and-longitudinal-data-analysis">Mixed-effects linear models and longitudinal data analysis</h1>
<p>In this section, you will find the R code that we will use during the course. We will explain the code and output during correction of the exercises.</p>
<p><strong>After having completed this chapter you will be able to:</strong></p>
<ul>
<li>Plot individual linear models or LOESS fits on data (Tolerance data)</li>
<li>Understand Mixed Effect Models </li>
<li>Understand Fixed and Random effects on categorical data (Corn)</li>
<li>Understand longitudinal data analysis (Tolerance data)</li>
<li>Understand comparisons of models (Tolerance data)</li>
<li>Biological interpretation of model comparisons (BtheB data)</li>
<li>Integrating B-Spline Basis matrix for Polynomial Splines and random effects (Bone data set)</li>
<li>Interaction term and Random effects (Brain Data)</li>
</ul>
<p>Slides of lectures:</p>
<p><a class="md-button" href="../assets/pdf/Day3-Longitudinaldataanalysis-2025.pdf">Download slides</a></p>
<div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">nlme</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">splines</span><span class="p">)</span>
</code></pre></div>
<h2 id="tolerance-data-set">Tolerance data set</h2>
<div class="highlight"><pre><span></span><code><span class="c1"># load the &quot;tolerance&quot; data set: &quot;tolerance.RData&quot;</span>
<span class="nf">load</span><span class="p">(</span><span class="s">&quot;exercises/tolerance.RData&quot;</span><span class="p">)</span>

<span class="nf">str</span><span class="p">(</span><span class="n">tolerance_untidy</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">tolerance_tidy</span><span class="p">)</span>
</code></pre></div>
<h3 id="perform-a-graphical-exploration-of-the-data">Perform a graphical exploration of the data</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># scatterplots of raw data</span>
<span class="nf">xyplot</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w"> </span><span class="n">as.table</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
</code></pre></div>
<h3 id="analysis-of-individual-change-over-time">Analysis of individual change over time</h3>
<h4 id="non-parametric-smoothing-spline-fit">Non-parametric smoothing spline fit</h4>
<p>We first fit a smoothing spline between the points, this is done using the function panel.spline().
<div class="highlight"><pre><span></span><code><span class="nf">xyplot</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w"> </span>
<span class="w">       </span><span class="n">prepanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="nf">prepanel.spline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="w"> </span>
<span class="w">       </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tolerance&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">       </span><span class="n">panel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">){</span><span class="w"> </span>
<span class="w">         </span><span class="nf">panel.xyplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span>
<span class="w">         </span><span class="nf">panel.spline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)}</span>
<span class="p">)</span>
</code></pre></div></p>
<h4 id="nonparametric-loess-fit">Nonparametric loess fit</h4>
<p>Try fitting a LOESS function on the xy panel. </p>
<details class="hint">
<summary>Hint</summary>
<p>Try the help function ?prepanel.spline() that you have seen previously for smoothing splines to understand what to change. Is it the only function you need to change ?</p>
</details>
<details class="done">
<summary>Answer</summary>
<div class="highlight"><pre><span></span><code><span class="nf">xyplot</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">,</span>
<span class="w">   </span><span class="n">prepanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="nf">prepanel.loess</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="s">&quot;gaussian&quot;</span><span class="p">),</span>
<span class="w">   </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tolerance&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="n">panel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">){</span>
<span class="w">     </span><span class="nf">panel.xyplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="w">     </span><span class="nf">panel.loess</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="s">&quot;gaussian&quot;</span><span class="p">)}</span>
<span class="p">)</span>
</code></pre></div>
</details>
<h4 id="parametriclinear-fit">Parametric/linear fit</h4>
<p>Try now a linear fit. Which function do you need to change</p>
<details class="done">
<summary>Answer</summary>
<div class="highlight"><pre><span></span><code><span class="nf">xyplot</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">,</span>
<span class="w">   </span><span class="n">prepanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="nf">prepanel.lmline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
<span class="w">   </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;tolerance&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="n">panel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">){</span>
<span class="w">     </span><span class="nf">panel.xyplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="w">     </span><span class="nf">panel.lmline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)}</span>
<span class="w">  </span><span class="p">)</span>
</code></pre></div>
</details>
<h4 id="individual-linear-fits">Individual linear fits</h4>
<p>Extract summary from individual linear fits.
<div class="highlight"><pre><span></span><code><span class="n">lm.summary</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">by</span><span class="p">(</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w"> </span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="nf">lm</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">x</span><span class="p">)))</span>
<span class="n">lm.summary</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
<span class="n">lm.summary</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">coefficients</span>

<span class="c1"># fetch intercepts</span>
<span class="n">all.intercept</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sapply</span><span class="p">(</span><span class="n">lm.summary</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">coefficients</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">])</span>

<span class="c1"># fetch slopes</span>
<span class="n">all.slope</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sapply</span><span class="p">(</span><span class="n">lm.summary</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">coefficients</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">])</span>

<span class="c1"># fetch residual variances, i.e. (Residual standard error)^2</span>
<span class="n">all.resVar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sapply</span><span class="p">(</span><span class="n">lm.summary</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">sigma</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>

<span class="c1"># fetch R-squared statistic</span>
<span class="n">all.r2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sapply</span><span class="p">(</span><span class="n">lm.summary</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">r.squared</span><span class="p">)</span>

<span class="c1"># combine them in one matrix</span>
<span class="n">my.summary</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rbind</span><span class="p">(</span><span class="n">all.intercept</span><span class="p">,</span><span class="w"> </span><span class="n">all.slope</span><span class="p">,</span><span class="w"> </span><span class="n">all.resVar</span><span class="p">,</span><span class="w"> </span><span class="n">all.r2</span><span class="p">)</span>
<span class="n">my.summary</span>

<span class="c1"># remove the junk</span>
<span class="nf">rm</span><span class="p">(</span><span class="n">all.intercept</span><span class="p">,</span><span class="w"> </span><span class="n">all.slope</span><span class="p">,</span><span class="w"> </span><span class="n">all.resVar</span><span class="p">,</span><span class="w"> </span><span class="n">all.r2</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="analysis-of-inter-individual-differences">Analysis of inter-individual differences</h3>
<h4 id="average-of-the-curves-nonparametric">Average of the curves (nonparametric)</h4>
<p>We will proceed by making a plot with all the smooth splines calculated for all the individual.
We then calculate averages of values calculated on a grid. This points will then be used to again calculate a smoothing spline. 
<div class="highlight"><pre><span></span><code><span class="c1"># start with an empty plot</span>
<span class="nf">plot</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;tolerance&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="m">15</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;nonparametric&quot;</span><span class="p">)</span>

<span class="c1"># i) discretize time on a grid</span>
<span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="n">length.out</span><span class="o">=</span><span class="m">100</span><span class="p">)</span>

<span class="c1"># ii) estimate individual trajectories</span>
<span class="n">indiv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">unique</span><span class="p">(</span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">id</span><span class="p">)</span>

<span class="c1"># create matrix to store estimates on the grid</span>
<span class="n">est.nonpara</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">100</span><span class="p">)</span>

<span class="c1"># loop on individuals to plot individual curves and extract estimates on the grid</span>
<span class="kr">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">indiv</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">temp.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w"> </span><span class="n">subset</span><span class="o">=</span><span class="p">(</span><span class="n">id</span><span class="o">==</span><span class="n">indiv</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="w">  </span><span class="n">age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">temp.data</span><span class="o">$</span><span class="n">age</span>
<span class="w">  </span><span class="n">tolerance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">temp.data</span><span class="o">$</span><span class="n">tolerance</span>
<span class="w">  </span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">smooth.spline</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">tolerance</span><span class="p">)</span>
<span class="w">  </span><span class="n">est</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">age</span><span class="o">=</span><span class="n">t</span><span class="p">))</span>
<span class="w">  </span><span class="c1"># plot the estimate</span>
<span class="w">  </span><span class="nf">lines</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="n">est</span><span class="o">$</span><span class="n">x</span><span class="p">),</span><span class="nf">t</span><span class="p">(</span><span class="n">est</span><span class="o">$</span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;grey&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="c1"># store the estimate</span>
<span class="w">  </span><span class="n">est.nonpara</span><span class="p">[</span><span class="n">i</span><span class="p">,]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">t</span><span class="p">(</span><span class="n">est</span><span class="o">$</span><span class="n">y</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># average individual estimates for each point on the grid</span>
<span class="n">avg.est</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">est.nonpara</span><span class="p">,</span><span class="w"> </span><span class="n">MARGIN</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>

<span class="c1"># apply same smoothing algorithm to averages</span>
<span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">smooth.spline</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">avg.est</span><span class="p">)</span>

<span class="c1"># overlay the curve of the averages</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">fit</span><span class="o">$</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="c1"># assign ids to rownames</span>
<span class="nf">rownames</span><span class="p">(</span><span class="n">est.nonpara</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">indiv</span>
<span class="n">est.nonpara</span>

<span class="c1"># remove the junk</span>
<span class="nf">rm</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">indiv</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">temp.data</span><span class="p">,</span><span class="n">age</span><span class="p">,</span><span class="n">tolerance</span><span class="p">,</span><span class="n">fit</span><span class="p">,</span><span class="n">est</span><span class="p">,</span><span class="n">avg.est</span><span class="p">)</span>
</code></pre></div></p>
<h4 id="average-of-the-curves-parametric">Average of the curves (parametric)</h4>
<p>In the parametric form, we will predict values on a grid for all the samples, then calculate averages.
<div class="highlight"><pre><span></span><code><span class="c1"># start with an empty plot</span>
<span class="nf">plot</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;tolerance&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="m">15</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;parametric&quot;</span><span class="p">)</span>

<span class="c1"># i) discretize time on a grid</span>
<span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="n">length.out</span><span class="o">=</span><span class="m">100</span><span class="p">)</span>

<span class="c1"># centering time predictor is optional but doing so improves the interpretability of the intercept (i.e. the intercept will reflect baseline exposure at age=11)</span>
<span class="n">t.cent</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="n">length.out</span><span class="o">=</span><span class="m">100</span><span class="p">)</span><span class="w"> </span>

<span class="c1"># ii) estimate individual trajectories</span>
<span class="n">indiv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">unique</span><span class="p">(</span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">id</span><span class="p">)</span>

<span class="c1"># matrix to store estimates on the grid</span>
<span class="n">est.para</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="o">=</span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="o">=</span><span class="m">100</span><span class="p">)</span>

<span class="c1"># loop on individuals to plot individual curves and extract estimates on the grid</span>
<span class="kr">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">indiv</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">temp.data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w"> </span><span class="n">subset</span><span class="o">=</span><span class="p">(</span><span class="n">id</span><span class="o">==</span><span class="n">indiv</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="w">  </span><span class="n">age</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">temp.data</span><span class="o">$</span><span class="n">age</span>
<span class="w">  </span><span class="n">age.cent</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">temp.data</span><span class="o">$</span><span class="n">age</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">11</span>
<span class="w">  </span><span class="n">tolerance</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">temp.data</span><span class="o">$</span><span class="n">tolerance</span>
<span class="w">  </span><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age.cent</span><span class="p">)</span>
<span class="w">  </span><span class="n">est</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">age.cent</span><span class="o">=</span><span class="n">t.cent</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;response&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="c1"># plot the estimate</span>
<span class="w">  </span><span class="nf">abline</span><span class="p">(</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="w"> </span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;grey&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="c1"># store the estimate</span>
<span class="w">  </span><span class="n">est.para</span><span class="p">[</span><span class="n">i</span><span class="p">,]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">est</span>
<span class="p">}</span>

<span class="c1"># average individual estimates for each point on the grid</span>
<span class="n">avg.est</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">est.para</span><span class="p">,</span><span class="w"> </span><span class="n">MARGIN</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>

<span class="c1"># apply same smoothing algorithm to averages</span>
<span class="nf">abline</span><span class="p">(</span><span class="nf">lm</span><span class="p">(</span><span class="w"> </span><span class="n">avg.est</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">t</span><span class="p">),</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="c1"># assign ids to rownames</span>
<span class="nf">rownames</span><span class="p">(</span><span class="n">est.para</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">indiv</span>
<span class="n">est.para</span>

<span class="c1"># remove the junk</span>
<span class="nf">rm</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t.cent</span><span class="p">,</span><span class="n">indiv</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">temp.data</span><span class="p">,</span><span class="n">age</span><span class="p">,</span><span class="n">age.cent</span><span class="p">,</span><span class="n">tolerance</span><span class="p">,</span><span class="n">fit</span><span class="p">,</span><span class="n">est</span><span class="p">,</span><span class="n">avg.est</span><span class="p">)</span>
</code></pre></div></p>
<h4 id="intercepts-and-slopes-from-linear-fit">Intercepts and slopes from linear fit</h4>
<p>Fetch the intercepts and slopes from the linear fit
<div class="highlight"><pre><span></span><code><span class="c1"># all.intercepts</span>
<span class="nf">mean</span><span class="p">(</span><span class="n">my.summary</span><span class="p">[</span><span class="s">&quot;all.intercept&quot;</span><span class="p">,])</span><span class="w"> </span><span class="c1"># 1.35775</span>
<span class="nf">sqrt</span><span class="p">(</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="n">my.summary</span><span class="p">[</span><span class="s">&quot;all.intercept&quot;</span><span class="p">,])</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1"># 0.2977792</span>

<span class="c1"># all.slopes</span>
<span class="nf">mean</span><span class="p">(</span><span class="n">my.summary</span><span class="p">[</span><span class="s">&quot;all.slope&quot;</span><span class="p">,])</span><span class="w"> </span><span class="c1"># 0.1308125</span>
<span class="nf">sqrt</span><span class="p">(</span><span class="w"> </span><span class="nf">var</span><span class="p">(</span><span class="n">my.summary</span><span class="p">[</span><span class="s">&quot;all.slope&quot;</span><span class="p">,])</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1"># 0.172296</span>

<span class="c1"># bivariate correlation</span>
<span class="nf">cor</span><span class="p">(</span><span class="n">my.summary</span><span class="p">[</span><span class="s">&quot;all.intercept&quot;</span><span class="p">,],</span><span class="w"> </span><span class="n">my.summary</span><span class="p">[</span><span class="s">&quot;all.slope&quot;</span><span class="p">,])</span><span class="w"> </span><span class="c1"># -0.4481135</span>
</code></pre></div></p>
<h4 id="stratify-based-on-covariates">Stratify based on covariates</h4>
<p>We can stratify the calculated curves based on covariates. We can associate p-values of the estimated parameters, answering questions such as is there any major difference in the calculated slopes in Men vs Women ? This enables to obtain p-value on inter-individual changes. 
We first start with the covariate Gender: 
<div class="highlight"><pre><span></span><code><span class="nf">table</span><span class="p">(</span><span class="n">tolerance_untidy</span><span class="o">$</span><span class="n">male</span><span class="p">)</span><span class="w"> </span><span class="c1"># 9 x females and 7 x males</span>

<span class="c1"># discretize time on a grid</span>
<span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="n">length.out</span><span class="o">=</span><span class="m">100</span><span class="p">)</span>

<span class="c1"># figure with 2 panels</span>
<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>

<span class="c1"># plot individual males</span>
<span class="n">est.para_males</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">est.para</span><span class="p">[</span><span class="nf">rownames</span><span class="p">(</span><span class="n">est.para</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">tolerance_untidy</span><span class="o">$</span><span class="n">id</span><span class="p">[</span><span class="n">tolerance_untidy</span><span class="o">$</span><span class="n">male</span><span class="o">==</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="p">]</span>
<span class="nf">plot</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;tolerance&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="m">15</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;males&quot;</span><span class="p">)</span>
<span class="nf">apply</span><span class="p">(</span><span class="n">est.para_males</span><span class="p">,</span><span class="w"> </span><span class="n">MARGIN</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="nf">lines</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;gray&quot;</span><span class="p">)},</span><span class="w"> </span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
<span class="n">avg.est</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">est.para_males</span><span class="p">,</span><span class="w"> </span><span class="n">MARGIN</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>
<span class="nf">abline</span><span class="p">(</span><span class="nf">lm</span><span class="p">(</span><span class="w"> </span><span class="n">avg.est</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">t</span><span class="p">),</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="c1"># plot individual females</span>
<span class="n">est.para_females</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">est.para</span><span class="p">[</span><span class="nf">rownames</span><span class="p">(</span><span class="n">est.para</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">tolerance_untidy</span><span class="o">$</span><span class="n">id</span><span class="p">[</span><span class="n">tolerance_untidy</span><span class="o">$</span><span class="n">male</span><span class="o">==</span><span class="m">0</span><span class="p">],</span><span class="w"> </span><span class="p">]</span>
<span class="nf">plot</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;tolerance&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="m">15</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;females&quot;</span><span class="p">)</span>
<span class="nf">apply</span><span class="p">(</span><span class="n">est.para_females</span><span class="p">,</span><span class="w"> </span><span class="n">MARGIN</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="nf">lines</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;gray&quot;</span><span class="p">)},</span><span class="w"> </span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
<span class="n">avg.est</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">est.para_females</span><span class="p">,</span><span class="w"> </span><span class="n">MARGIN</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>
<span class="nf">abline</span><span class="p">(</span><span class="nf">lm</span><span class="p">(</span><span class="w"> </span><span class="n">avg.est</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">t</span><span class="p">),</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="c1"># remove the junk</span>
<span class="nf">rm</span><span class="p">(</span><span class="n">est.para_males</span><span class="p">,</span><span class="w"> </span><span class="n">est.para_females</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">avg.est</span><span class="p">)</span>
</code></pre></div></p>
<p>Then the covariate Exposure:
<div class="highlight"><pre><span></span><code><span class="nf">summary</span><span class="p">(</span><span class="n">tolerance_untidy</span><span class="o">$</span><span class="n">exposure</span><span class="p">)</span>

<span class="c1"># exposure is a continuous time-invariant predictor, and thus can be categorized for visualization</span>
<span class="n">median.exposure</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">median</span><span class="p">(</span><span class="n">tolerance_untidy</span><span class="o">$</span><span class="n">exposure</span><span class="p">)</span>

<span class="c1"># discretize time on a grid</span>
<span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="n">length.out</span><span class="o">=</span><span class="m">100</span><span class="p">)</span>

<span class="c1"># figure with 2 panels</span>
<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span>

<span class="c1"># plot individuals with high-exposure</span>
<span class="n">est.para_highExposure</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">est.para</span><span class="p">[</span><span class="nf">rownames</span><span class="p">(</span><span class="n">est.para</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">tolerance_untidy</span><span class="o">$</span><span class="n">id</span><span class="p">[</span><span class="n">tolerance_untidy</span><span class="o">$</span><span class="n">exposure</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">median.exposure</span><span class="p">],</span><span class="w"> </span><span class="p">]</span>
<span class="nf">plot</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;tolerance&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="m">15</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;high-exposure&quot;</span><span class="p">)</span>
<span class="nf">apply</span><span class="p">(</span><span class="n">est.para_highExposure</span><span class="p">,</span><span class="w"> </span><span class="n">MARGIN</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="nf">lines</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;gray&quot;</span><span class="p">)},</span><span class="w"> </span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
<span class="n">avg.est</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">est.para_highExposure</span><span class="p">,</span><span class="w"> </span><span class="n">MARGIN</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>
<span class="nf">abline</span><span class="p">(</span><span class="nf">lm</span><span class="p">(</span><span class="w"> </span><span class="n">avg.est</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">t</span><span class="p">),</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="c1"># plot individuals with low-exposure</span>
<span class="n">est.para_lowExposure</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">est.para</span><span class="p">[</span><span class="nf">rownames</span><span class="p">(</span><span class="n">est.para</span><span class="p">)</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">tolerance_untidy</span><span class="o">$</span><span class="n">id</span><span class="p">[</span><span class="n">tolerance_untidy</span><span class="o">$</span><span class="n">exposure</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">median.exposure</span><span class="p">],</span><span class="w"> </span><span class="p">]</span>
<span class="nf">plot</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s">&quot;n&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;tolerance&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="m">15</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;low-exposure&quot;</span><span class="p">)</span>
<span class="nf">apply</span><span class="p">(</span><span class="n">est.para_lowExposure</span><span class="p">,</span><span class="w"> </span><span class="n">MARGIN</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="nf">lines</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;gray&quot;</span><span class="p">)},</span><span class="w"> </span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
<span class="n">avg.est</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">est.para_lowExposure</span><span class="p">,</span><span class="w"> </span><span class="n">MARGIN</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>
<span class="nf">abline</span><span class="p">(</span><span class="nf">lm</span><span class="p">(</span><span class="w"> </span><span class="n">avg.est</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">t</span><span class="p">),</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="c1"># remove the junk</span>
<span class="nf">rm</span><span class="p">(</span><span class="n">est.para_highExposure</span><span class="p">,</span><span class="w"> </span><span class="n">est.para_lowExposure</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">avg.est</span><span class="p">)</span>
<span class="nf">rm</span><span class="p">(</span><span class="n">median.exposure</span><span class="p">)</span>
</code></pre></div></p>
<h2 id="corn-data">Corn Data</h2>
<p>We work with the dataframe: ant111b in the DAAG package.
It is an agricultural experiment on the Caribbean island of Antigua.
Corn yield measurements were taken on 4 parcels at 8 sites. We need to discover how to model the harvest weight, and understand if there are significant changes in the sites and parcels, or other covariates in this dataset. 
<div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">DAAG</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span><span class="w"> </span>
<span class="nf">library</span><span class="p">(</span><span class="n">lme4</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">WWGbook</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="data-exploration-of-harvwt">Data Exploration of harvwt</h3>
<div class="highlight"><pre><span></span><code><span class="nf">data</span><span class="p">(</span><span class="n">ant111b</span><span class="p">)</span>

<span class="nf">str</span><span class="p">(</span><span class="n">ant111b</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">ant111b</span><span class="p">)</span><span class="w"> </span>

<span class="nf">dotplot</span><span class="p">(</span><span class="nf">reorder</span><span class="p">(</span><span class="n">site</span><span class="p">,</span><span class="w"> </span><span class="n">harvwt</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">harvwt</span><span class="p">,</span><span class="w"> </span><span class="n">ant111b</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Harvest weight of corn&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Site&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">aspect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.32</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;p&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">))</span>
</code></pre></div>
<p>The line joins the means of the harvest weight of the individual sites. The sites have been reordered by increasing mean harvwt</p>
<h3 id="data-modelling-with-fixed-and-random-effects">Data modelling with fixed and random effects</h3>
<p>Model the harvwt by the sites and compare to a null model. Then, add a random effect. 
<div class="highlight"><pre><span></span><code><span class="nf">summary</span><span class="p">(</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="w"> </span><span class="n">ant111b</span><span class="o">$</span><span class="n">harvwt</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">ant111b</span><span class="o">$</span><span class="n">site</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="w"> </span><span class="n">ant111b</span><span class="o">$</span><span class="n">harvwt</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">ant111b</span><span class="o">$</span><span class="n">site</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>

<span class="n">model.1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="w"> </span><span class="n">ant111b</span><span class="o">$</span><span class="n">harvwt</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">ant111b</span><span class="o">$</span><span class="n">site</span><span class="w"> </span><span class="p">)</span>
<span class="n">model.null</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="w"> </span><span class="n">ant111b</span><span class="o">$</span><span class="n">harvwt</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">model.null</span><span class="p">,</span><span class="w"> </span><span class="n">model.1</span><span class="p">)</span>

<span class="nf">mean</span><span class="p">(</span><span class="n">ant111b</span><span class="o">$</span><span class="n">harvwt</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">(</span><span class="n">ant111b</span><span class="p">[</span><span class="n">ant111b</span><span class="o">$</span><span class="n">site</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;DBAN&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">harvwt</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">(</span><span class="n">ant111b</span><span class="p">[</span><span class="n">ant111b</span><span class="o">$</span><span class="n">site</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;LFAN&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">harvwt</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">(</span><span class="n">ant111b</span><span class="p">[</span><span class="n">ant111b</span><span class="o">$</span><span class="n">site</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;NSAN&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">harvwt</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">(</span><span class="n">ant111b</span><span class="p">[</span><span class="n">ant111b</span><span class="o">$</span><span class="n">site</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;ORAN&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">harvwt</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">(</span><span class="n">ant111b</span><span class="p">[</span><span class="n">ant111b</span><span class="o">$</span><span class="n">site</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;OVAN&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">harvwt</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">(</span><span class="n">ant111b</span><span class="p">[</span><span class="n">ant111b</span><span class="o">$</span><span class="n">site</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;TEAN&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">harvwt</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">(</span><span class="n">ant111b</span><span class="p">[</span><span class="n">ant111b</span><span class="o">$</span><span class="n">site</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;WEAN&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">harvwt</span><span class="p">)</span>
<span class="nf">mean</span><span class="p">(</span><span class="n">ant111b</span><span class="p">[</span><span class="n">ant111b</span><span class="o">$</span><span class="n">site</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;WLAN&quot;</span><span class="p">,]</span><span class="o">$</span><span class="n">harvwt</span><span class="p">)</span>

<span class="n">ant111b.lmer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lmer</span><span class="p">(</span><span class="n">harvwt</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">site</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">ant111b</span><span class="p">)</span>
<span class="n">ant111b.lmer</span>
</code></pre></div></p>
<p>Our model has one fixed effect parameter (the first 1): the mean harvest weight and one random effect term (1|site): the variation across sites.
There are two sources of random variation: one for site and one for parcel within site.
The estimated variance components are:
site = 1.5392^2 = 2.369
residual = 0.762 = 0.577</p>
<div class="highlight"><pre><span></span><code><span class="nf">mean</span><span class="p">(</span><span class="n">ant111b</span><span class="o">$</span><span class="n">harvwt</span><span class="p">)</span>
<span class="nf">sqrt</span><span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="n">ant111b</span><span class="o">$</span><span class="n">harvwt</span><span class="p">))</span>
<span class="nf">fixef</span><span class="p">(</span><span class="n">ant111b.lmer</span><span class="p">)</span>
</code></pre></div>
<p>The numbers provided by ranef aren&rsquo;t estimates of the random effects
They are called BLUPs (Best Linear Unbiased Predictors) of the random effects.
<div class="highlight"><pre><span></span><code><span class="nf">ranef</span><span class="p">(</span><span class="n">ant111b.lmer</span><span class="p">)</span>
<span class="nf">fitted</span><span class="p">(</span><span class="n">ant111b.lmer</span><span class="p">)</span>

<span class="n">means</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">with</span><span class="p">(</span><span class="n">ant111b</span><span class="p">,</span><span class="w"> </span><span class="nf">sapply</span><span class="p">(</span><span class="nf">split</span><span class="p">(</span><span class="n">harvwt</span><span class="p">,</span><span class="w"> </span><span class="n">site</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">))</span>
<span class="n">siteFit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">with</span><span class="p">(</span><span class="n">ant111b</span><span class="p">,</span><span class="w"> </span><span class="nf">sapply</span><span class="p">(</span><span class="nf">split</span><span class="p">(</span><span class="nf">fitted</span><span class="p">(</span><span class="n">ant111b.lmer</span><span class="p">),</span><span class="w"> </span><span class="n">site</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">data.frame</span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">means</span><span class="p">,</span><span class="w"> </span><span class="n">fitted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">siteFit</span><span class="p">))</span>
</code></pre></div></p>
<p>The fitted values are not just the sample means.
They are shrinkage estimates that are between the grand (overall) mean and the individual sample means
<div class="highlight"><pre><span></span><code><span class="c1"># site  mean    fitted      site    ranef   </span>
<span class="c1"># DBAN  4.885   4.851         DBAN  0.559     0.061</span>
<span class="c1"># LFAN  4.208   4.212         LFAN  -0.079  0.061</span>
<span class="c1"># NSAN  2.090   2.217         NSAN  -2.075  0.061</span>
<span class="c1"># ORAN  6.915   6.764         ORAN  2.473     0.061</span>
<span class="c1"># OVAN  4.833   4.801         OVAN  0.510     0.061</span>
<span class="c1"># TEAN  3.036   3.108         TEAN  -1.183  0.061</span>
<span class="c1"># WEAN  5.526   5.455         WEAN  1.164     0.061</span>
<span class="c1"># WLAN  2.841   2.925         WLAN  -1.367  0.061</span>
<span class="c1"># var     2.512 2.232         var     2.232 </span>
<span class="c1"># stdev 1.585   1.494         stdev 1.494   </span>
</code></pre></div>
This can be summarized with the following dotplot.
<div class="highlight"><pre><span></span><code><span class="nf">dotplot</span><span class="p">(</span><span class="nf">ranef</span><span class="p">(</span><span class="n">ant111b.lmer</span><span class="p">,</span><span class="w"> </span><span class="n">condVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">strip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="w"> </span>
</code></pre></div></p>
<p>Now, we will do the same type of modeling but this time with the ears variable as the outcome.</p>
<h3 id="1-data-exploration-of-ear">1. Data exploration of ear</h3>
<p>Make a dotplot of the number of ears by site, sorting by mean ears as follows:
<div class="highlight"><pre><span></span><code><span class="nf">dotplot</span><span class="p">(</span><span class="nf">reorder</span><span class="p">(</span><span class="n">site</span><span class="p">,</span><span class="w"> </span><span class="n">ears</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">ears</span><span class="p">,</span><span class="w"> </span><span class="n">ant111b</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Number of ears of corn&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Site&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">aspect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.32</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;p&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">))</span>
</code></pre></div></p>
<p>Comment on your plot - do any effects seem to contribute to the variation in ears ? </p>
<h3 id="2-fit-a-random-effects-model">2. Fit a random effects model</h3>
<p><div class="highlight"><pre><span></span><code><span class="n">ears.lmer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lmer</span><span class="p">(</span><span class="n">ears</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">site</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">ant111b</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">ears.lmer</span><span class="p">)</span>
</code></pre></div>
There are two sources of random variation, one for site and one for parcel within site (residual), each with an estimated variance (and SD).</p>
<p>Find the grand mean.
<div class="highlight"><pre><span></span><code><span class="nf">mean</span><span class="p">(</span><span class="n">ant111b</span><span class="o">$</span><span class="n">ears</span><span class="p">)</span>
<span class="nf">fixef</span><span class="p">(</span><span class="n">ears.lmer</span><span class="p">)</span>
</code></pre></div></p>
<p>Make a table showing the sample mean and fitted value for each site.
Note that the fitted values are not just the sample means, but
are between the grand mean and individual group sample means.
<div class="highlight"><pre><span></span><code><span class="n">means</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">with</span><span class="p">(</span><span class="n">ant111b</span><span class="p">,</span><span class="w"> </span><span class="nf">sapply</span><span class="p">(</span><span class="nf">split</span><span class="p">(</span><span class="n">ears</span><span class="p">,</span><span class="w"> </span><span class="n">site</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">))</span>
<span class="n">siteFit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">with</span><span class="p">(</span><span class="n">ant111b</span><span class="p">,</span><span class="w"> </span><span class="nf">sapply</span><span class="p">(</span><span class="nf">split</span><span class="p">(</span><span class="nf">fitted</span><span class="p">(</span><span class="n">ears.lmer</span><span class="p">),</span><span class="w"> </span><span class="n">site</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">data.frame</span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">means</span><span class="p">,</span><span class="w"> </span><span class="n">fitted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">siteFit</span><span class="p">))</span>
</code></pre></div></p>
<p>Give the estimated variance for each source of variation, site and residual.</p>
<div class="highlight"><pre><span></span><code><span class="n">variance.site</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="m">6.760</span><span class="o">^</span><span class="m">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45.696</span>
<span class="n">variance.residual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3.980</span><span class="o">^</span><span class="m">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15.839</span><span class="w"> </span>
</code></pre></div>
<p>Which source of variation is larger ?
What proportion of variation is due to differences between sites ?
Make a caterpillar plot for the random effects.
Does the plot support your conclusion about the source of variation ?
Which site(s) are most &lsquo;unusual&rsquo;?</p>
<div class="highlight"><pre><span></span><code><span class="nf">dotplot</span><span class="p">(</span><span class="nf">ranef</span><span class="p">(</span><span class="n">ears.lmer</span><span class="p">,</span><span class="w"> </span><span class="n">condVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">strip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="w"> </span>
</code></pre></div>
<h3 id="3-model-assumptions">3. Model assumptions</h3>
<p>It is also a good idea to check the model assumptions with a few diagnostic plots.
There should not be any apparent pattern in the residuals.
You can check this by making a plot of residuals versus fitted values:
<div class="highlight"><pre><span></span><code><span class="nf">plot</span><span class="p">(</span><span class="nf">fitted</span><span class="p">(</span><span class="n">ears.lmer</span><span class="p">),</span><span class="w"> </span><span class="nf">residuals</span><span class="p">(</span><span class="n">ears.lmer</span><span class="p">),</span><span class="w"> </span><span class="n">main</span><span class="o">=</span><span class="s">&quot;residual plot&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">19</span><span class="p">)</span>
<span class="nf">abline</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</code></pre></div></p>
<p>The residuals should also be normally distributed.
You can check this by making a normal quantile-quantile (QQ) plot.
If the points fall along a straight line, the distribution is approximately normal.
<div class="highlight"><pre><span></span><code><span class="nf">qqnorm</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">ears.lmer</span><span class="p">))</span>
<span class="nf">qqline</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">ears.lmer</span><span class="p">))</span><span class="w"> </span>
<span class="nf">shapiro.test</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">ears.lmer</span><span class="p">))</span>
</code></pre></div>
What do you conclude ? </p>
<h2 id="tolerance-data-set2">Tolerance data set2</h2>
<p>We take again a look at the tolerance dataset and will have now a new look on it with mixed effect modelling.</p>
<div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">nlme</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">splines</span><span class="p">)</span>
</code></pre></div>
<h3 id="multi-level-mixed-effects-modeling">multi-level / mixed-effects modeling</h3>
<p>Let&rsquo;s begin by assessing the need for a multi-level model
First, we will fit a baseline model (only including an intercept) using ML
Next, we will fit another model that allows intercepts to vary between clusters
(i.e. a random intercept model)
finally we compare the two models to see if the fit has improved as a result of allowing
intercepts to vary</p>
<h3 id="fit-the-1st-model">Fit the 1st model</h3>
<p>Simplest model, also called null model.
<div class="highlight"><pre><span></span><code><span class="n">fit.01</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">gls</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.01</span><span class="p">)</span>

<span class="c1"># plot fit.01</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">tolerance</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;tolerance&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">)</span>
<span class="n">fit.01</span><span class="o">$</span><span class="n">coefficients</span>
<span class="nf">abline</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="m">1.619375</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="fit-the-2nd-model">Fit the 2nd model</h3>
<p>Now we put a random effect that is linked to the ids of the kids. This assumes that there is no change true time in the answer to the tolerance in kids, however kids ID matter, i.e. some kids will start higher and some lower and will stay high respectively low in their tolerance to deviant behaviour.
<div class="highlight"><pre><span></span><code><span class="n">fit.02</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.02</span><span class="p">)</span>
<span class="n">fit.02</span><span class="o">$</span><span class="n">coefficients</span>

<span class="c1"># plot fit.02 for patient &quot;978&quot; and compare with fit.01</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">tolerance</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;tolerance&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">)</span>
<span class="nf">points</span><span class="p">(</span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">age</span><span class="p">[</span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="s">&quot;978&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">tolerance</span><span class="p">[</span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="s">&quot;978&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">)</span>
<span class="n">fit.02</span><span class="o">$</span><span class="n">coefficients</span>
<span class="nf">abline</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fit.02</span><span class="o">$</span><span class="n">coefficients</span><span class="o">$</span><span class="n">fixed</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="n">fit.02</span><span class="o">$</span><span class="n">coefficients</span><span class="o">$</span><span class="n">fixed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">unlist</span><span class="p">(</span><span class="n">fit.02</span><span class="o">$</span><span class="n">coefficients</span><span class="o">$</span><span class="n">random</span><span class="p">)[</span><span class="m">12</span><span class="p">]</span>
<span class="nf">abline</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fit.02</span><span class="o">$</span><span class="n">coefficients</span><span class="o">$</span><span class="n">fixed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">unlist</span><span class="p">(</span><span class="n">fit.02</span><span class="o">$</span><span class="n">coefficients</span><span class="o">$</span><span class="n">random</span><span class="p">)[</span><span class="m">12</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="c1"># plot fit.02 for all individual</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">tolerance</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;tolerance&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">)</span>
<span class="nf">abline</span><span class="p">(</span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fit.02</span><span class="o">$</span><span class="n">coefficients</span><span class="o">$</span><span class="n">fixed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">unlist</span><span class="p">(</span><span class="n">fit.02</span><span class="o">$</span><span class="n">coefficients</span><span class="o">$</span><span class="n">random</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</code></pre></div></p>
<p>Compare the two using AIC, BIC, and likelihood-ratio(LR)
<div class="highlight"><pre><span></span><code><span class="nf">anova</span><span class="p">(</span><span class="n">fit.01</span><span class="p">,</span><span class="n">fit.02</span><span class="p">)</span>
</code></pre></div>
Keeping in mind that the assumptions of the LR test is that:
i) models were fit using ML
ii) model are nested
both assumption were met and p-val&lt;0.05; therefore we can conclude that allowing for
random intercepts significantly improved the fit</p>
<h3 id="fit-the-3rd-model">Fit the 3rd model</h3>
<p>What if instead of random intercepts, we had allowed for random slopes?
We have no reason to believe that individuals should share a baseline value
(i.e. fixed intercept), but let&rsquo;s try it anyways for the sake of completeness.
This model will assume that there is a fixed intercept, therefore all the fitted lines start at the same height. But we say that time influences the results of the tolerance. How would you model it?</p>
<details class="done">
<summary>Answer</summary>
<div class="highlight"><pre><span></span><code><span class="n">fit.03</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">gls</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1"># using centered age (i.e.     time) for increased interpretability</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.03</span><span class="p">)</span>

<span class="c1"># plot fit.03</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">tolerance</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;tolerance&quot;</span><span class="p">,</span><span class="w">     </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">)</span>
<span class="n">fit.03</span><span class="o">$</span><span class="n">coefficients</span>
<span class="nf">abline</span><span class="p">(</span><span class="w"> </span><span class="nf">gls</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</code></pre></div>
</details>
<h3 id="fit-the-4th-model">Fit the 4th model</h3>
<p>What if the tolerance can be explained by time, but that the changes through time are dependant on the kid. But we expect the intercept to be the same for all individuals. </p>
<details class="done">
<summary>Answer</summary>
<div class="highlight"><pre><span></span><code><span class="n">fit.04</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="m">-1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w">     </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.04</span><span class="p">)</span>
<span class="n">fit.04</span><span class="o">$</span><span class="n">coefficients</span>

<span class="c1"># plot fit.04 for patient &quot;978&quot; and compare with fit.03</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">tolerance</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;tolerance&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">)</span>
<span class="nf">points</span><span class="p">(</span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">age</span><span class="p">[</span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="s">&quot;978&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">tolerance</span><span class="p">[</span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">id</span><span class="o">==</span><span class="s">&quot;978&quot;</span><span class="p">],</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">16</span><span class="p">)</span>
<span class="nf">abline</span><span class="p">(</span><span class="nf">lm</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
<span class="n">predict.fit.04</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">fit.04</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="o">=</span><span class="nf">data.frame</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="n">length.out</span><span class="o">=</span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s">&quot;978&quot;</span><span class="p">))</span>
<span class="nf">lines</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="n">length.out</span><span class="o">=</span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="n">predict.fit.04</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>

<span class="c1"># plot fit.04 for all individuals</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">tolerance</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;tolerance&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">)</span>
<span class="n">id</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="nf">unique</span><span class="p">(</span><span class="n">tolerance_untidy</span><span class="o">$</span><span class="n">id</span><span class="p">))</span>
<span class="kr">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">id</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w"> </span><span class="n">predict.fit.04</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">fit.04</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="o">=</span><span class="nf">data.frame</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nf">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="n">length.out</span><span class="o">=</span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="n">id</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="w"> </span><span class="nf">lines</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="m">11</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="n">length.out</span><span class="o">=</span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="n">predict.fit.04</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
</details>
<p>compare the two using AIC, BIC, and LR</p>
<div class="highlight"><pre><span></span><code><span class="nf">anova</span><span class="p">(</span><span class="n">fit.03</span><span class="p">,</span><span class="n">fit.04</span><span class="p">)</span>
</code></pre></div>
<h3 id="fit-the-5th-model">Fit the 5th model</h3>
<p>What if instead we had allowed for both random intercepts and random slopes? This means kids do not all start at the same tolerance level, tolerance changes through time but also each kids way of changing true time is significantly different. </p>
<details class="done">
<summary>Answer</summary>
<div class="highlight"><pre><span></span><code><span class="n">fit.05</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.05</span><span class="p">)</span>


<span class="c1"># extract both fixed and random parameters</span>
<span class="n">fit.05</span><span class="o">$</span><span class="n">coefficients</span>
<span class="nf">coef</span><span class="p">(</span><span class="n">fit.05</span><span class="p">)</span><span class="w"> </span><span class="c1"># only fixed parameters</span>
<span class="nf">ranef</span><span class="p">(</span><span class="n">fit.05</span><span class="p">)</span><span class="w"> </span><span class="c1"># only random parameters</span>
</code></pre></div>
</details>
<p>compare the two using likelihood-ratio(LR)
<div class="highlight"><pre><span></span><code><span class="nf">anova</span><span class="p">(</span><span class="n">fit.03</span><span class="p">,</span><span class="n">fit.05</span><span class="p">)</span>
<span class="c1"># Based on what we saw above, can you plot these fitted models? (i.e. fit.03 and fit.05)</span>
</code></pre></div></p>
<h3 id="fit-the-6th-model">Fit the 6th model</h3>
<p>Now let&rsquo;s bring in additional covariates. </p>
<p>Starting with adding gender, are boys and girls any different in how they tolerate deviant behaviour ? 
<div class="highlight"><pre><span></span><code><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">male</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">tolerance_tidy</span><span class="o">$</span><span class="n">male</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
<span class="n">fit.06</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">male</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.06</span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">fit.03</span><span class="p">,</span><span class="n">fit.06</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="fit-the-7th-model">Fit the 7th model</h3>
<p>adding exposure. This is the starting measure each kid has given.
<div class="highlight"><pre><span></span><code><span class="n">fit.07</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">male</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">exposure</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.07</span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">fit.06</span><span class="p">,</span><span class="n">fit.07</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="fit-the-8th-model">Fit the 8th model</h3>
<p>adding interaction between male and exposure, is the exposure of boys and exposure of girls having a different impact on tolerance (this would be the case for instance if one suspects that girls that rate themselves higher at start have then a very different, for instance more steap curve then boys that rate themselves with a high exposure value).</p>
<details class="done">
<summary>Answer</summary>
<div class="highlight"><pre><span></span><code><span class="n">fit.08</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">male</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">exposure</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.08</span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">fit.07</span><span class="p">,</span><span class="n">fit.08</span><span class="p">)</span>
</code></pre></div>
</details>
<h3 id="fit-the-9th-model">Fit the 9th model</h3>
<p>adding interaction between male and time.</p>
<div class="highlight"><pre><span></span><code><span class="n">fit.09</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">exposure</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">male</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.09</span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">fit.07</span><span class="p">,</span><span class="n">fit.09</span><span class="p">)</span><span class="w"> </span><span class="c1"># this agrees with our observation from exploratory analysis</span>
</code></pre></div>
<h3 id="fit-the-10th-model">Fit the 10th model</h3>
<p>adding interaction between exposure and time
<div class="highlight"><pre><span></span><code><span class="n">fit.10</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">tolerance</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">male</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">exposure</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">tolerance_tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.10</span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">fit.07</span><span class="p">,</span><span class="n">fit.10</span><span class="p">)</span>
</code></pre></div>
This agrees with our observation from exploratory analysis
Based on above, we will choose fit.07 as our model.</p>
<h2 id="btheb-data-set">BtheB data set</h2>
<p>Load the needed packages
<div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">nlme</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">splines</span><span class="p">)</span>
</code></pre></div></p>
<p>Load and hava a look at the &ldquo;BtheB_tidy&rdquo; data set: &ldquo;BtheB_tidy.RData&rdquo;
<div class="highlight"><pre><span></span><code><span class="nf">load</span><span class="p">(</span><span class="s">&quot;exercises/BtheB_tidy.RData&quot;</span><span class="p">)</span>

<span class="c1"># examine the data </span>
<span class="nf">str</span><span class="p">(</span><span class="n">BtheB.tidy</span><span class="p">)</span>
</code></pre></div></p>
<p>Store &ldquo;pre&rdquo; bdi values separately as baseline
<div class="highlight"><pre><span></span><code><span class="n">temp.pre</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="w"> </span><span class="n">BtheB.tidy</span><span class="p">,</span><span class="w"> </span><span class="n">subset</span><span class="o">=</span><span class="p">(</span><span class="n">timepoint</span><span class="o">==</span><span class="s">&quot;pre&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="n">temp.pre</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">temp.pre</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">)]</span>
<span class="n">BtheB.tidy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="w"> </span><span class="n">BtheB.tidy</span><span class="p">,</span><span class="w"> </span><span class="n">subset</span><span class="o">=</span><span class="p">(</span><span class="n">timepoint</span><span class="o">!=</span><span class="s">&quot;pre&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">BtheB.tidy</span><span class="o">$</span><span class="n">indiv</span>
<span class="n">temp2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">()</span>
<span class="kr">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">temp2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">temp.pre</span><span class="o">$</span><span class="n">bdi</span><span class="p">[</span><span class="n">temp.pre</span><span class="o">$</span><span class="n">indiv</span><span class="o">==</span><span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
<span class="p">}</span>
<span class="n">BtheB.tidy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cbind.data.frame</span><span class="p">(</span><span class="n">BtheB.tidy</span><span class="p">,</span><span class="w"> </span><span class="n">pre.bdi</span><span class="o">=</span><span class="n">temp2</span><span class="p">)</span>
<span class="nf">rm</span><span class="p">(</span><span class="n">temp.pre</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="n">temp2</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
</code></pre></div></p>
<p>Let&rsquo;s convert timepoints to numerics
<div class="highlight"><pre><span></span><code><span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">BtheB.tidy</span><span class="o">$</span><span class="n">timepoint</span><span class="p">)</span>
<span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">replace</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="o">==</span><span class="s">&quot;2m&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">replace</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="o">==</span><span class="s">&quot;4m&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">)</span>
<span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">replace</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="o">==</span><span class="s">&quot;6m&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">)</span>
<span class="n">temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">replace</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="o">==</span><span class="s">&quot;8m&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">)</span>
<span class="n">BtheB.tidy</span><span class="o">$</span><span class="n">timepoint</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">BtheB.tidy</span><span class="p">)</span>
<span class="nf">rm</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="exploratory-analysis">Exploratory analysis</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># raw data</span>
<span class="nf">xyplot</span><span class="p">(</span><span class="n">bdi</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">timepoint</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">indiv</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">BtheB.tidy</span><span class="p">,</span><span class="w"> </span><span class="n">as.table</span><span class="o">=</span><span class="bp">F</span><span class="p">,</span>
<span class="w">       </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bdi&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="model-fittingselection">Model fitting/selection</h3>
<div class="highlight"><pre><span></span><code><span class="n">fit.01</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">gls</span><span class="p">(</span><span class="n">bdi</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">timepoint</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">BtheB.tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.action</span><span class="o">=</span><span class="n">na.omit</span><span class="p">)</span>
<span class="n">fit.02</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">bdi</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">timepoint</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">indiv</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">BtheB.tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.action</span><span class="o">=</span><span class="n">na.omit</span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">fit.01</span><span class="p">,</span><span class="n">fit.02</span><span class="p">)</span>
</code></pre></div>
<p>What is the conclusion ? </p>
<details class="answer">
<summary>Answer</summary>
<p>Including random intercepts improves the goodness of fit.</p>
</details>
<p><div class="highlight"><pre><span></span><code><span class="n">fit.03</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">bdi</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">timepoint</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">timepoint</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">indiv</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">BtheB.tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.action</span><span class="o">=</span><span class="n">na.omit</span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">fit.02</span><span class="p">,</span><span class="n">fit.03</span><span class="p">)</span>
</code></pre></div>
And here ?</p>
<details class="answer">
<summary>Answer</summary>
<p>Including random slopes does not improve the goodness of fit
Based on the result above, we will choose the simpler random intercepts model </p>
</details>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In lme by default na.action is set to na.fail, hence you&rsquo;ll get an error if NA values are present.By setting na.action=na.omit, we throw away rows with NAs in them. Keep in mind that we are not throwing away subjects (cases) who happen to have a missing value, just those time points that have missing response</p>
</div>
<p>Let&rsquo;s bring in the covariate drug.
<div class="highlight"><pre><span></span><code><span class="n">fit.04</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">bdi</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">drug</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">timepoint</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">indiv</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">BtheB.tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.action</span><span class="o">=</span><span class="n">na.omit</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.04</span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">fit.02</span><span class="p">,</span><span class="n">fit.04</span><span class="p">)</span>
</code></pre></div></p>
<p>How about length ?
<div class="highlight"><pre><span></span><code><span class="n">fit.05</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">bdi</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">timepoint</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">indiv</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">BtheB.tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.action</span><span class="o">=</span><span class="n">na.omit</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.05</span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">fit.02</span><span class="p">,</span><span class="n">fit.05</span><span class="p">)</span>
</code></pre></div></p>
<p>How about treatment ?
<div class="highlight"><pre><span></span><code><span class="n">fit.06</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">bdi</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">treatment</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">timepoint</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">indiv</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">BtheB.tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.action</span><span class="o">=</span><span class="n">na.omit</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.06</span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">fit.02</span><span class="p">,</span><span class="n">fit.06</span><span class="p">)</span>
</code></pre></div></p>
<p>How about baseline ?
<div class="highlight"><pre><span></span><code><span class="n">fit.07</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">bdi</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pre.bdi</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">timepoint</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">indiv</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">BtheB.tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.action</span><span class="o">=</span><span class="n">na.omit</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.07</span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">fit.02</span><span class="p">,</span><span class="n">fit.07</span><span class="p">)</span>
</code></pre></div></p>
<p>Is there an interaction between baseline and temporal pattern ?
<div class="highlight"><pre><span></span><code><span class="n">fit.08</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">bdi</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pre.bdi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">timepoint</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">indiv</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">BtheB.tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.action</span><span class="o">=</span><span class="n">na.omit</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.08</span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">fit.07</span><span class="p">,</span><span class="n">fit.08</span><span class="p">)</span>
</code></pre></div>
What if we had included all covariates from the beginning ?
<div class="highlight"><pre><span></span><code><span class="n">fit.09</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">gls</span><span class="p">(</span><span class="n">bdi</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pre.bdi</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">drug</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">treatment</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">timepoint</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">BtheB.tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.action</span><span class="o">=</span><span class="n">na.omit</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.09</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">fit.10</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">bdi</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pre.bdi</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">drug</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">treatment</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">timepoint</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">indiv</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">BtheB.tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.action</span><span class="o">=</span><span class="n">na.omit</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.10</span><span class="p">)</span>
</code></pre></div>
Compare the fits
<div class="highlight"><pre><span></span><code><span class="nf">anova</span><span class="p">(</span><span class="n">fit.09</span><span class="p">,</span><span class="n">fit.10</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">fit.11</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">bdi</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pre.bdi</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">drug</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">treatment</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">timepoint</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">timepoint</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">indiv</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">BtheB.tidy</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">na.action</span><span class="o">=</span><span class="n">na.omit</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.11</span><span class="p">)</span>
</code></pre></div>
Compare the fits
<div class="highlight"><pre><span></span><code><span class="nf">anova</span><span class="p">(</span><span class="n">fit.10</span><span class="p">,</span><span class="n">fit.11</span><span class="p">)</span>
</code></pre></div></p>
<p>let&rsquo;s look at summary of fit.10 one more time
<div class="highlight"><pre><span></span><code><span class="nf">summary</span><span class="p">(</span><span class="n">fit.10</span><span class="p">)</span>
</code></pre></div>
While baseline and time both significantly affect bdi, there is no evidence for a treatment effect  </p>
<h2 id="bone-data-set">Bone data set</h2>
<p>Load packages
<div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">nlme</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">splines</span><span class="p">)</span>
</code></pre></div>
Relative spinal bone mineral density (spnbmd) measurements on 261 North American adolescents.
Each value is the difference in spnbmd between two consecutive visits, divided by the average.
The age is the average of the age over the two visits.
load and examine the &ldquo;bone&rdquo; data set: &ldquo;bone.RData&rdquo;</p>
<div class="highlight"><pre><span></span><code><span class="nf">load</span><span class="p">(</span><span class="s">&quot;exercises/bone.RData&quot;</span><span class="p">)</span>

<span class="c1"># examine the data </span>
<span class="nf">str</span><span class="p">(</span><span class="n">bone</span><span class="p">)</span>
</code></pre></div>
<p>convert idnum to factor
<div class="highlight"><pre><span></span><code><span class="n">bone</span><span class="o">$</span><span class="n">idnum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">bone</span><span class="o">$</span><span class="n">idnum</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">bone</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="exploratory-analysis_1">Exploratory analysis</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># raw data</span>
<span class="nf">xyplot</span><span class="p">(</span><span class="n">spnbmd</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idnum</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">bone</span><span class="p">,</span><span class="w"> </span><span class="n">subset</span><span class="o">=</span><span class="p">(</span><span class="n">idnum</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="n">bone</span><span class="o">$</span><span class="n">idnum</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="o">=</span><span class="bp">F</span><span class="p">)),</span><span class="w"> </span>
<span class="w">       </span><span class="n">as.table</span><span class="o">=</span><span class="bp">F</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;spnbmd&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="parametriclinear-fit_1">Parametric/linear fit</h3>
<div class="highlight"><pre><span></span><code><span class="nf">xyplot</span><span class="p">(</span><span class="n">spnbmd</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idnum</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">bone</span><span class="p">,</span><span class="w"> </span><span class="n">subset</span><span class="o">=</span><span class="p">(</span><span class="n">idnum</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="n">bone</span><span class="o">$</span><span class="n">idnum</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="o">=</span><span class="bp">F</span><span class="p">)),</span>
<span class="w">       </span><span class="n">prepanel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="nf">prepanel.lmline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
<span class="w">       </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;spnbmd&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="n">panel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nf">panel.xyplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="w">         </span><span class="nf">panel.lmline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="compare-the-trends-for-male-and-females">Compare the trends for male and females</h3>
<p>We will ignore the repeated measures
<div class="highlight"><pre><span></span><code><span class="nf">plot</span><span class="p">(</span><span class="w"> </span><span class="n">bone</span><span class="o">$</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">bone</span><span class="o">$</span><span class="n">spnbmd</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;spnbmd&quot;</span><span class="p">)</span>
<span class="n">bone.spline.male</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">with</span><span class="p">(</span><span class="nf">subset</span><span class="p">(</span><span class="n">bone</span><span class="p">,</span><span class="n">gender</span><span class="o">==</span><span class="s">&quot;male&quot;</span><span class="p">),</span><span class="w"> </span><span class="nf">smooth.spline</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">spnbmd</span><span class="p">))</span>
<span class="n">bone.spline.female</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">with</span><span class="p">(</span><span class="nf">subset</span><span class="p">(</span><span class="n">bone</span><span class="p">,</span><span class="w"> </span><span class="n">gender</span><span class="o">==</span><span class="s">&quot;female&quot;</span><span class="p">),</span><span class="w"> </span><span class="nf">smooth.spline</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">spnbmd</span><span class="p">))</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">bone.spline.male</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">bone.spline.female</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">legend</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="m">0.20</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;male&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Female&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;red2&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="using-cubic-splines">Using cubic splines</h3>
<div class="highlight"><pre><span></span><code><span class="m">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">bone.spline.female</span><span class="o">$</span><span class="n">df</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bone.spline.male</span><span class="o">$</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="c1"># 6.6</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">spnbmd</span><span class="o">~</span><span class="n">age</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">bone</span><span class="p">)</span>
<span class="n">fit.00</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lm</span><span class="p">(</span><span class="n">spnbmd</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">bs</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">=</span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">bone</span><span class="p">)</span><span class="w"> </span><span class="c1"># df=6 corresponds to 3 internal knots</span>
<span class="n">predict.male</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">fit.00</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="o">=</span><span class="nf">data.frame</span><span class="p">(</span><span class="n">age</span><span class="o">=</span><span class="nf">seq</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">25</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="n">.</span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">gender</span><span class="o">=</span><span class="s">&quot;male&quot;</span><span class="p">))</span>
<span class="n">predict.female</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">fit.00</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="o">=</span><span class="nf">data.frame</span><span class="p">(</span><span class="n">age</span><span class="o">=</span><span class="nf">seq</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">25</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="n">.</span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">gender</span><span class="o">=</span><span class="s">&quot;female&quot;</span><span class="p">))</span>
<span class="nf">lines</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">25</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="n">.</span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">predict.male</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">25</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="n">.</span><span class="m">5</span><span class="p">),</span><span class="w"> </span><span class="n">predict.female</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
</code></pre></div>
<h3 id="model-fittingselection_1">Model fitting/selection</h3>
<div class="highlight"><pre><span></span><code><span class="n">fit.01</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">gls</span><span class="p">(</span><span class="n">spnbmd</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">bs</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">=</span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">bone</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.01</span><span class="p">)</span>

<span class="n">fit.02</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">spnbmd</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">bs</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">=</span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">random</span><span class="o">=</span><span class="p">(</span><span class="o">~</span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idnum</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">bone</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">fit.02</span><span class="p">)</span>

<span class="nf">anova</span><span class="p">(</span><span class="n">fit.01</span><span class="p">,</span><span class="n">fit.02</span><span class="p">)</span>

<span class="c1"># testing if males and females show different trends</span>
<span class="n">fit.02</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">spnbmd</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">bs</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">=</span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">random</span><span class="o">=</span><span class="p">(</span><span class="o">~</span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idnum</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">bone</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">)</span>
<span class="n">fit.03</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lme</span><span class="p">(</span><span class="n">spnbmd</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">gender</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">bs</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="o">=</span><span class="m">6</span><span class="p">),</span><span class="w"> </span><span class="n">random</span><span class="o">=</span><span class="p">(</span><span class="o">~</span><span class="m">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">idnum</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">bone</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">=</span><span class="s">&quot;ML&quot;</span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">fit.02</span><span class="p">,</span><span class="n">fit.03</span><span class="p">)</span>
</code></pre></div>
<p>Therefore we conclude that change in relative spinal bone mineral density versus age is different between males and females.</p>
<h2 id="rat-brain-data">Rat Brain Data</h2>
<p><div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">DAAG</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">lattice</span><span class="p">)</span><span class="w"> </span>
<span class="nf">library</span><span class="p">(</span><span class="n">lme4</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">WWGbook</span><span class="p">)</span>
</code></pre></div>
The rat brain data is called rat.brain in the WWGbook package.
The aim of the experiment was to examine nucleotide activation
(guanine nucleotide bonding) in six different brain nuclei (i.e., brain regions)
among five adult male rats.
A data frame with 30 observations on the following 4 variables.
animal: Unique identifier for each rat
treatment: Level of drug treatment (1 = Basal, 2 = Carbachol)
region: Brain nucleus (1 = BST, 2 = LS, 3 = VDB)
activate: Nucleotide activation (the dependent variable)</p>
<h3 id="1-exploration-of-the-data">1. Exploration of the data</h3>
<div class="highlight"><pre><span></span><code><span class="nf">attach</span><span class="p">(</span><span class="n">rat.brain</span><span class="p">)</span>
<span class="nf">str</span><span class="p">(</span><span class="n">rat.brain</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">rat.brain</span><span class="p">)</span>
</code></pre></div>
<p>In order to use treatment and region correctly in the model, they will each need
to be coded as a factor (what type of variables are they now ?):</p>
<div class="highlight"><pre><span></span><code><span class="n">region.f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">region</span>
<span class="n">region.f</span><span class="p">[</span><span class="n">region</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span>
<span class="n">region.f</span><span class="p">[</span><span class="n">region</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span>
<span class="n">region.f</span><span class="p">[</span><span class="n">region</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span>
<span class="n">region.f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">region.f</span><span class="p">)</span>
<span class="nf">levels</span><span class="p">(</span><span class="n">region.f</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;VST&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;BST&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;LS&quot;</span><span class="p">)</span>

<span class="n">treat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">treatment</span><span class="p">)</span>
<span class="nf">levels</span><span class="p">(</span><span class="n">treat</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Basal&quot;</span><span class="p">,</span><span class="s">&quot;Carbachol&quot;</span><span class="p">)</span>

<span class="n">rat.brain</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">rat.brain</span><span class="p">,</span><span class="w"> </span><span class="n">region.f</span><span class="p">,</span><span class="w"> </span><span class="n">treat</span><span class="p">)</span>

<span class="nf">str</span><span class="p">(</span><span class="n">rat.brain</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">rat.brain</span><span class="p">)</span>
</code></pre></div>
<p>First try to get some idea what the data look like through graphical exploration.
Here are a few different representations of the data.
Try them all out - which do you think is most revealing ?
<div class="highlight"><pre><span></span><code><span class="nf">dotplot</span><span class="p">(</span><span class="nf">reorder</span><span class="p">(</span><span class="n">animal</span><span class="p">,</span><span class="w"> </span><span class="n">activate</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">activate</span><span class="p">,</span><span class="w"> </span><span class="n">rat.brain</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">region.f</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Animal&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Activate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">19</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;p&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">auto.key</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">lines</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span>
</code></pre></div></p>
<p>Here we have plotted results for each rat (ordered by increasing mean(activate),
but this includes both treatment measurements for each rat.
Let&rsquo;s look at each rat/treatment combination separately:
<div class="highlight"><pre><span></span><code><span class="n">rat.brain</span><span class="o">$</span><span class="n">rt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">with</span><span class="p">(</span><span class="n">rat.brain</span><span class="p">,</span><span class="w"> </span><span class="n">treat</span><span class="o">:</span><span class="nf">factor</span><span class="p">(</span><span class="n">animal</span><span class="p">))</span>

<span class="nf">dotplot</span><span class="p">(</span><span class="nf">reorder</span><span class="p">(</span><span class="n">rt</span><span class="p">,</span><span class="w"> </span><span class="n">activate</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">activate</span><span class="p">,</span><span class="w"> </span><span class="n">rat.brain</span><span class="p">,</span><span class="w"> </span><span class="n">groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">region.f</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Animal&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Activate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">19</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;p&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">auto.key</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">lines</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span>
</code></pre></div></p>
<p>Each rat separately:</p>
<div class="highlight"><pre><span></span><code><span class="nf">xyplot</span><span class="p">(</span><span class="n">activate</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">treat</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">animal</span><span class="p">,</span><span class="w"> </span><span class="n">rat.brain</span><span class="p">,</span><span class="w"> </span><span class="n">aspect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;xy&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span>
<span class="w">       </span><span class="n">groups</span><span class="o">=</span><span class="n">region.f</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;p&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;l&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;g&quot;</span><span class="p">),</span><span class="w"> </span>
<span class="w">       </span><span class="n">index.cond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="nf">coef</span><span class="p">(</span><span class="nf">lm</span><span class="p">(</span><span class="n">y</span><span class="o">~</span><span class="n">x</span><span class="p">))[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Treatment&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">       </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;Activate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">auto.key</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">space</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="n">lines</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="m">3</span><span class="p">))</span>
</code></pre></div>
<p>Separated by treatment group:
<div class="highlight"><pre><span></span><code><span class="nf">xyplot</span><span class="p">(</span><span class="n">activate</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">region.f</span><span class="o">|</span><span class="n">treat</span><span class="p">,</span><span class="w"> </span><span class="n">rat.brain</span><span class="p">,</span><span class="w"> </span><span class="n">groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">animal</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">19</span><span class="p">,</span><span class="w"> </span>
<span class="w">       </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">800</span><span class="p">),</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Region&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;Activate&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">       </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;p&quot;</span><span class="p">,</span><span class="s">&quot;a&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">auto.key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">space</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">))</span>
</code></pre></div></p>
<p>Does the treatment appear to have an effect ? Why do you say that ? 
Does the effect (if any) appear to be the same in each region ?
Do there appear to be rat-specific effects ? </p>
<h3 id="2-model-fitting">2. Model fitting</h3>
<p>We will start with fitting a model including all fixed effects (main effects and
interactions for the treatment and region variables - make sure to use the factor versions)
and a random effect for animal.
As above, you can use extractor functions to view some of the model components.
<div class="highlight"><pre><span></span><code><span class="n">rat.brain.lmer1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lmer</span><span class="p">(</span><span class="n">activate</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">region.f</span><span class="o">*</span><span class="n">treat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">animal</span><span class="p">),</span><span class="w"> </span><span class="n">REML</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rat.brain</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">rat.brain.lmer1</span><span class="p">)</span>
</code></pre></div>
Make sure that you know how to interpret the coefficients (the interpretation will be determined by the coding). </p>
<h3 id="3-add-random-effects">3. Add random effects</h3>
<p>From the plot above, we saw that between-animal variation was greater for the
carbachol treatment than for the basal treatment. To accommodate this difference in
variation, we can add a random animal-specific effect of treatment to the model.
The effect of treatment is fixed in our original model, therefore constant across
all animals. The additional random effect associated with treatment that we include
in the new model allows the implied marginal variance of observations for the carbachol
treatment to differ from that for the basal treatment.
We can also think of the new model as having two random intercepts per rat, one for
the carbachol treatment and an additional one for the basal treatment.
<div class="highlight"><pre><span></span><code><span class="n">rat.brain.lmer2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lmer</span><span class="p">(</span><span class="n">activate</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">region.f</span><span class="o">*</span><span class="n">treat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">treat</span><span class="w"> </span><span class="o">|</span><span class="n">animal</span><span class="p">),</span><span class="w"> </span><span class="n">REML</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rat.brain</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">rat.brain.lmer2</span><span class="p">)</span>
</code></pre></div>
What happens to the estimated fixed effects coefficients? What about their standard errors?</p>
<h3 id="4-compare-using-lr">4. Compare using LR</h3>
<p>We can compare the models using a likelihood ratio (LR) test, carried out with
the anova function. The anova method for mer objects carries out a ML (not REML) LR test,
even if the model has been fit by REML. The results are not identical for the two methods,
but in this case the conclusions are the same.</p>
<div class="highlight"><pre><span></span><code><span class="nf">anova</span><span class="p">(</span><span class="n">rat.brain.lmer1</span><span class="p">,</span><span class="w"> </span><span class="n">rat.brain.lmer2</span><span class="p">)</span>
</code></pre></div>
<h3 id="5-model-assumptions">5. Model assumptions</h3>
<p>As above, we check some diagnostics for the final model.</p>
<p>Residual plot:
<div class="highlight"><pre><span></span><code><span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">fitted</span><span class="p">(</span><span class="n">rat.brain.lmer2</span><span class="p">)</span>
<span class="n">res</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">resid</span><span class="p">(</span><span class="n">rat.brain.lmer2</span><span class="p">)</span>
<span class="n">plotres.fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">rat.brain</span><span class="p">,</span><span class="w"> </span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">)</span>
<span class="nf">xyplot</span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">plotres.fit</span><span class="p">,</span><span class="w"> </span><span class="n">groups</span><span class="o">=</span><span class="n">treat</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="o">=</span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="s">&quot;Predicted value&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;Residual&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">abline</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">auto.key</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">space</span><span class="o">=</span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">columns</span><span class="o">=</span><span class="m">2</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># QQ normal plot:</span>
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">rat.brain.lmer2</span><span class="p">))</span>
<span class="nf">qqline</span><span class="p">(</span><span class="nf">resid</span><span class="p">(</span><span class="n">rat.brain.lmer2</span><span class="p">))</span>
</code></pre></div>
What do you conclude ?</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>