
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../day1/">
      
      
        <link rel="next" href="../day3/">
      
      
      <link rel="icon" href="../assets/images/SIB_logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Day2-GLM - Advanced statistics</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#generalized-linear-models" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Advanced statistics" class="md-header__button md-logo" aria-label="Advanced statistics" data-md-component="logo">
      
  <img src="../assets/images/SIB_logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Advanced statistics
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Day2-GLM
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/sib-swiss/advanced-statistics" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    sib-swiss/advanced-statistics
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Advanced statistics" class="md-nav__button md-logo" aria-label="Advanced statistics" data-md-component="logo">
      
  <img src="../assets/images/SIB_logo.svg" alt="logo">

    </a>
    Advanced statistics
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sib-swiss/advanced-statistics" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    sib-swiss/advanced-statistics
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../precourse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Precourse preparation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../course_schedule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Course schedule
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../day1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Day1-Linear Regression and Beyond
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Day2-GLM
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Day2-GLM
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-outcomes-of-the-day" class="md-nav__link">
    <span class="md-ellipsis">
      Learning outcomes of the day
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#warm-up" class="md-nav__link">
    <span class="md-ellipsis">
      Warm up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#challenge-baby-food" class="md-nav__link">
    <span class="md-ellipsis">
      Challenge: baby food
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#warm-up-2" class="md-nav__link">
    <span class="md-ellipsis">
      Warm up 2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-1-michelin-food" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 1: Michelin food
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-2-moth-death" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 2: moth death
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-3-beetle" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 3: beetle
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-4-pima" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 4: Pima
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-5-lung-cancer" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 5: lung cancer
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../day3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Day3-Mixed Effect Models
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../day4_new/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Day4-Caret
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../day4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bonus exercice
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../exam/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exam
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../links/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Useful links
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-outcomes-of-the-day" class="md-nav__link">
    <span class="md-ellipsis">
      Learning outcomes of the day
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#warm-up" class="md-nav__link">
    <span class="md-ellipsis">
      Warm up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#challenge-baby-food" class="md-nav__link">
    <span class="md-ellipsis">
      Challenge: baby food
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#warm-up-2" class="md-nav__link">
    <span class="md-ellipsis">
      Warm up 2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-1-michelin-food" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 1: Michelin food
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-2-moth-death" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 2: moth death
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-3-beetle" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 3: beetle
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-4-pima" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 4: Pima
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-5-lung-cancer" class="md-nav__link">
    <span class="md-ellipsis">
      Exercise 5: lung cancer
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="generalized-linear-models">Generalized linear models</h1>
<p>In this section, you will find the R code that we will use during the course. We will explain the code and output during correction of the exercises.</p>
<h2 id="learning-outcomes-of-the-day">Learning outcomes of the day</h2>
<p><strong>After having completed this chapter you will be able to:</strong></p>
<ul>
<li>Understand why linear models are not enough and how to spot it (Warm up)</li>
<li>Understand logistic regression with its residuals (Warm up)</li>
<li>Generalised linear models (Poisson for Warm up 2)</li>
<li>Understand proportion datasets, like in epidemiological studies (Baby food, Michelin Food)</li>
<li>Predict values for a new dataset (Michelin Food)</li>
<li>Interaction terms in proportion datasets (Moth death)</li>
<li>Understand the effect of different link functions (Beetle)</li>
<li>Understand diagnostic tools and confidence intervals (Pima)</li>
<li>Understand what an offset is (Lung cancer)</li>
</ul>
<p>Slides of lectures:</p>
<p><a class="md-button" href="../assets/pdf/Day2-LogisticregressionandGLM-2025.pdf">Download slides</a></p>
<h2 id="warm-up">Warm up</h2>
<p>The data records the birth weight of 1174 babies along with information on the mother and the pregnancy.
Load and explore the dataset babies, called babies.RData in your exercise folder.
<div class="highlight"><pre><span></span><code><span class="nf">load</span><span class="p">(</span><span class="s">&quot;exercises/babies.RData&quot;</span><span class="p">)</span>
<span class="nf">attach</span><span class="p">(</span><span class="n">babies</span><span class="p">)</span>
</code></pre></div></p>
<p>Perform a graphical exploration of the data
<div class="highlight"><pre><span></span><code><span class="nf">summary</span><span class="p">(</span><span class="n">babies</span><span class="p">)</span>
<span class="nf">pairs</span><span class="p">(</span><span class="n">babies</span><span class="p">)</span>
</code></pre></div></p>
<figure>
  <img src="../assets/images/day2_1.png" width="700"/>
  </figure>

<p>Which factor can explain prematurity?
 Can we use a linear model? If so, try to make predictions.</p>
<details class="done">
<summary>Answer</summary>
<p><div class="highlight"><pre><span></span><code>model1 &lt;- lm(as.numeric(as.numeric(levels(prem))[prem]) ~ bwt)
summary(model1)

plot(bwt, as.numeric(as.numeric(levels(prem))[prem]), ylab=&quot;premature&quot;, xlab=&quot;birth weight&quot;, main=&quot;Babies&quot;,
xlim=c(0,200), ylim=c(-0.2,1.2))
abline(model1, col=&quot;red&quot;, lwd=2)

new_bwt = 170
predict.model1 &lt;- predict.lm(model1, newdata=data.frame(bwt=new_bwt))
points(new_bwt, predict.model1, col=&quot;blue&quot;)
</code></pre></div>
<figure>
<img src="../assets/images/day2_2.png" width="700"/>
</figure></p>
</details>
<p>Fit a logistic regression to find parameters explaining the probability of prematurity ?
 What is the effect of birth weight on the probability of prematurity ?
 What about parity ?</p>
<details class="done">
<summary>Answer</summary>
<div class="highlight"><pre><span></span><code><span class="n">model2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="n">prem</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">bwt</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="n">binomial</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model2</span><span class="p">)</span>

<span class="n">model3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="n">prem</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">bwt</span><span class="o">+</span><span class="n">parity</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="n">binomial</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model3</span><span class="p">)</span>

<span class="n">model4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="n">prem</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">bwt</span><span class="o">*</span><span class="n">smoke</span><span class="o">+</span><span class="n">parity</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="n">binomial</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model4</span><span class="p">)</span>
</code></pre></div>
</details>
<p>Check the deviance residuals using the residualPlot function in the car library
<div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
<span class="nf">residualPlot</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;deviance&quot;</span><span class="p">)</span>
<span class="nf">residualPlot</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;response&quot;</span><span class="p">)</span>
<span class="nf">residualPlot</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;pearson&quot;</span><span class="p">)</span>
</code></pre></div></p>
<figure>
  <img src="../assets/images/day2_3.png" width="700"/>
  </figure>

<figure>
  <img src="../assets/images/day2_4.png" width="700"/>
  </figure>

<figure>
  <img src="../assets/images/day2_5.png" width="700"/>
  </figure>

<p>Construct the quantile residuals using the qresiduals function in the statmod library
Analyze the deviance
Look for potential influencial and outlying observations</p>
<details class="hint">
<summary>Hint</summary>
<p>Use the function acf()</p>
</details>
<details class="done">
<summary>Answer</summary>
<p><div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">statmod</span><span class="p">)</span>
<span class="n">model2.residuals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">qresiduals</span><span class="p">(</span><span class="n">model2</span><span class="p">)</span>
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">qnorm</span><span class="p">(</span><span class="n">model2.residuals</span><span class="p">))</span>
<span class="nf">qqline</span><span class="p">(</span><span class="nf">qnorm</span><span class="p">(</span><span class="n">model2.residuals</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s">&quot;red&quot;</span><span class="p">)</span>

<span class="n">model.null</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="n">prem</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binomial</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model.null</span><span class="p">)</span>
<span class="nf">anova</span><span class="p">(</span><span class="n">model.null</span><span class="p">,</span><span class="w"> </span><span class="n">model2</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Chisq&quot;</span><span class="p">)</span>

<span class="nf">influencePlot</span><span class="p">(</span><span class="n">model2</span><span class="p">)</span>
<span class="nf">acf</span><span class="p">(</span><span class="n">model2.residuals</span><span class="p">)</span>
</code></pre></div>
</p>
</details>
<figure>
  <img src="../assets/images/day2_6.png" width="700"/>
  </figure>
<figure>
  <img src="../assets/images/day2_7.png" width="700"/>
  </figure>
<figure>
  <img src="../assets/images/day2_8.png" width="700"/>
  </figure>

<h2 id="challenge-baby-food">Challenge: baby food</h2>
<div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">faraway</span><span class="p">)</span>
<span class="nf">data</span><span class="p">(</span><span class="n">babyfood</span><span class="p">)</span>
</code></pre></div>
<p>Explore the data</p>
<p><div class="highlight"><pre><span></span><code><span class="nf">summary</span><span class="p">(</span><span class="n">babyfood</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">(</span><span class="n">disease</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">food</span><span class="p">,</span><span class="w"> </span><span class="n">babyfood</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">(</span><span class="n">disease</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">babyfood</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">((</span><span class="n">disease</span><span class="o">/</span><span class="p">(</span><span class="n">disease</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nondisease</span><span class="p">))</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">food</span><span class="p">,</span><span class="w"> </span><span class="n">babyfood</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">((</span><span class="n">disease</span><span class="o">/</span><span class="p">(</span><span class="n">disease</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nondisease</span><span class="p">))</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">babyfood</span><span class="p">)</span>
</code></pre></div>
 
<figure>
  <img src="../assets/images/day2_2_1.png" width="700"/>
  </figure></p>
<figure>
  <img src="../assets/images/day2_2_2.png" width="700"/>
  </figure>
<figure>
  <img src="../assets/images/day2_2_3.png" width="700"/>
  </figure>
<figure>
  <img src="../assets/images/day2_2_4.png" width="700"/>
  </figure>

<p>Fit a logistic regression to explain the probability of disease by sex and food.</p>
<details class="done">
<summary>Answer</summary>
<div class="highlight"><pre><span></span><code><span class="n">mdl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">disease</span><span class="p">,</span><span class="w"> </span><span class="n">nondisease</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">food</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binomial</span><span class="p">,</span><span class="w"> </span><span class="n">babyfood</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">mdl</span><span class="p">)</span>
</code></pre></div>
</details>
<h2 id="warm-up-2">Warm up 2</h2>
<p>Explore the dataset gala in library faraway.
Remove the variable &ldquo;endemics&rdquo; which we will not use here.
<div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">faraway</span><span class="p">)</span>
<span class="nf">data</span><span class="p">(</span><span class="n">gala</span><span class="p">)</span>
<span class="n">gala</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gala</span><span class="p">[,</span><span class="m">-2</span><span class="p">]</span>

<span class="nf">summary</span><span class="p">(</span><span class="n">gala</span><span class="p">)</span>
</code></pre></div></p>
<p>Study the relationship between the number of plant species and several geographical variables of interest.</p>
<p><div class="highlight"><pre><span></span><code><span class="nf">pairs</span><span class="p">(</span><span class="n">gala</span><span class="p">)</span>
</code></pre></div>
 
<figure>
  <img src="../assets/images/day2_3_1.png" width="700"/>
  </figure>
</p>
<p>Fit a poisson model to the galapagos data.
Which variables are significant ? 
Check the deviance of the model</p>
<p><div class="highlight"><pre><span></span><code><span class="n">poisson.glm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="n">Species</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">gala</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="n">poisson</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">poisson.glm</span><span class="p">)</span>
<span class="nf">residualPlots</span><span class="p">(</span><span class="n">poisson.glm</span><span class="p">)</span>
</code></pre></div>
 
<figure>
  <img src="../assets/images/day2_3_2.png" width="700"/>
  </figure>
</p>
<h2 id="exercise-1-michelin-food">Exercise 1: Michelin food</h2>
<p>Here, we will use a data set containing food ratings for a number of restaurants, 
as well as information about whether or not they are included in the Michelin guide. 
The data set (called MichelinFood.txt) can be downloaded from the webpage of the book 
&ldquo;A Modern Approach to Regression with R&rdquo; by Simon J Sheather.
Download the file and import it into R or load it from the exercises folder.</p>
<div class="highlight"><pre><span></span><code><span class="n">michelin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.delim</span><span class="p">(</span><span class="s">&quot;exercises/MichelinFood.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s">&quot;\t&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">as.is</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="n">michelin</span>
</code></pre></div>
<p>The Food column represents the ranking of the food. 
The columns InMichelin and NotInMichelin contain the number of restaurants with 
the given food ranking that are/are not listed in the Michelin guide, respectively. 
The mi column contains the total number of examined restaurants with the given food ranking. 
Finally, the proportion column contains the fraction of examined restaurants with 
the given food ranking that were included in the Michelin guide.</p>
<ol>
<li>Start by graphically exploring the data</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nf">plot</span><span class="p">(</span><span class="n">michelin</span><span class="o">$</span><span class="n">Food</span><span class="p">,</span><span class="w"> </span><span class="n">michelin</span><span class="o">$</span><span class="n">proportion</span><span class="p">)</span>
</code></pre></div>
<ol start="2">
<li>Fit a GLM using a binomial model for the response, using the food ranking as the predictor.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">glm.mich</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">InMichelin</span><span class="p">,</span><span class="w"> </span><span class="n">NotInMichelin</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Food</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">binomial</span><span class="p">(</span><span class="n">logit</span><span class="p">),</span>
<span class="w">                </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">michelin</span><span class="p">)</span>
</code></pre></div>
<ol start="3">
<li>Predict the probabilities for a number of potential food rankings xnew, and plot a smooth function</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">xnew</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">Food</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="p">,</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="p">))</span>
<span class="n">pred.prop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">glm.mich</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xnew</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;response&quot;</span><span class="p">)</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">michelin</span><span class="o">$</span><span class="n">Food</span><span class="p">,</span><span class="w"> </span><span class="n">michelin</span><span class="o">$</span><span class="n">proportion</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">xnew</span><span class="o">$</span><span class="n">Food</span><span class="p">,</span><span class="w"> </span><span class="n">pred.prop</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
</code></pre></div>
<figure>
  <img src="../assets/images/day2_4_1.png" width="700"/>
  </figure>

<ol start="4">
<li>Check the model by looking at the residual deviance, other residuals and especially the quantile residuals</li>
</ol>
<details class="done">
<summary>Answer</summary>
<p><div class="highlight"><pre><span></span><code><span class="nf">require</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
<span class="nf">residualPlot</span><span class="p">(</span><span class="n">glm.mich</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;deviance&quot;</span><span class="p">)</span>
<span class="nf">residualPlot</span><span class="p">(</span><span class="n">glm.mich</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;response&quot;</span><span class="p">)</span>
<span class="nf">residualPlot</span><span class="p">(</span><span class="n">glm.mich</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;pearson&quot;</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">statmod</span><span class="p">)</span>
<span class="n">qres</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">qresiduals</span><span class="p">(</span><span class="n">glm.mich</span><span class="p">)</span>
<span class="nf">qqnorm</span><span class="p">(</span><span class="n">qres</span><span class="p">)</span>
<span class="nf">qqline</span><span class="p">(</span><span class="n">qres</span><span class="p">)</span>
<span class="nf">acf</span><span class="p">(</span><span class="n">qres</span><span class="p">)</span>
</code></pre></div>
  <figure>
  <img src="../assets/images/day2_4_2.png" width="700"/>
  </figure></p>
<p><figure>
  <img src="../assets/images/day2_4_3.png" width="700"/>
</figure></p>
<p><figure>
 <img src="../assets/images/day2_4_4.png" width="700"/>
 </figure></p>
<p><figure>
 <img src="../assets/images/day2_4_5.png" width="700"/>
 </figure></p>
<p><figure>
  <img src="../assets/images/day2_4_6.png" width="700"/>
 </figure></p>
</details>
<ol start="5">
<li>Check the model for potential influencial observations.</li>
</ol>
<details class="done">
<summary>Answer</summary>
<p><div class="highlight"><pre><span></span><code><span class="nf">influencePlot</span><span class="p">(</span><span class="n">glm.mich</span><span class="p">)</span>
</code></pre></div>
 <figure>
 <img src="../assets/images/day2_4_7.png" width="700"/>
 </figure></p>
</details>
<h2 id="exercise-2-moth-death">Exercise 2: moth death</h2>
<p>The next data set comes from Venables and Ripley (page 190) and encodes the number of moths
that died after exposure to different doses of trans-cypermethrin. 20 male and 20 female moths
were exposed to each dose, and the number of deaths in each group was recorded.
We generate a data frame containing the observed values. Since the doses are powers of two,
we use log2(dose) as the predictor rather than the actual dose.</p>
<div class="highlight"><pre><span></span><code><span class="n">moth</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;male&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;female&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">),</span>
<span class="w">                   </span><span class="n">dose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">log2</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="m">32</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">)),</span>
<span class="w">                   </span><span class="n">numdead</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">13</span><span class="p">,</span><span class="w"> </span><span class="m">18</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">16</span><span class="p">))</span>
<span class="n">moth</span><span class="o">$</span><span class="n">numalive</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">moth</span><span class="o">$</span><span class="n">numdead</span>
</code></pre></div>
<ol>
<li>Fit a GLM using the sex and dose as predictors. </li>
</ol>
<p>Do we need to include an interaction term in the model ?</p>
<details class="done">
<summary>Answer</summary>
<div class="highlight"><pre><span></span><code><span class="n">glm.moth.1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">numalive</span><span class="p">,</span><span class="w"> </span><span class="n">numdead</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">moth</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binomial</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">glm.moth.1</span><span class="p">)</span>
<span class="n">glm.moth.2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">numalive</span><span class="p">,</span><span class="w"> </span><span class="n">numdead</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">moth</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binomial</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">glm.moth.2</span><span class="p">)</span>
</code></pre></div>
</details>
<ol start="2">
<li>Does the model fit well ? Perform an analysis of deviance</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">glm.null</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">numalive</span><span class="p">,</span><span class="w"> </span><span class="n">numdead</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">moth</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binomial</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">glm.null</span><span class="p">)</span>
</code></pre></div>
<p>If a pair of models is nested (i.e. the smaller model is a special case of the larger one) then we can test
H0 : smaller model is true versus H1 : larger model is true
by doing likelihood ratio testing, and comparing the difference in deviance
to a chi2 distribution with degrees of freedom = df for smaller model - df for larger model
<div class="highlight"><pre><span></span><code><span class="nf">anova</span><span class="p">(</span><span class="n">glm.null</span><span class="p">,</span><span class="w"> </span><span class="n">glm.moth.1</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Chisq&quot;</span><span class="p">)</span>
</code></pre></div>
3. Predict the probabilities for different doses and include a smooth line in the plots</p>
<p><div class="highlight"><pre><span></span><code><span class="n">xnew</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;male&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;female&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="p">),</span><span class="w"> </span>
<span class="w">                   </span><span class="n">dose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">30</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">))</span>
<span class="n">pred.prop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">glm.moth.1</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xnew</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;response&quot;</span><span class="p">)</span>
<span class="n">moth</span><span class="o">$</span><span class="n">proportion</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">moth</span><span class="o">$</span><span class="n">numalive</span><span class="o">/</span><span class="p">(</span><span class="n">moth</span><span class="o">$</span><span class="n">numdead</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">moth</span><span class="o">$</span><span class="n">numalive</span><span class="p">)</span>
<span class="n">color</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">moth</span><span class="o">$</span><span class="n">sex</span>
<span class="n">color</span><span class="p">[</span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;male&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;blue&quot;</span>
<span class="n">color</span><span class="p">[</span><span class="n">color</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;female&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;red&quot;</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">moth</span><span class="o">$</span><span class="n">proportion</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">moth</span><span class="o">$</span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">xnew</span><span class="o">$</span><span class="n">dose</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">xnew</span><span class="o">$</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;male&quot;</span><span class="p">)],</span><span class="w"> </span><span class="n">pred.prop</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">xnew</span><span class="o">$</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;male&quot;</span><span class="p">)],</span>
<span class="w">      </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">xnew</span><span class="o">$</span><span class="n">dose</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">xnew</span><span class="o">$</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;female&quot;</span><span class="p">)],</span><span class="w"> </span><span class="n">pred.prop</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">xnew</span><span class="o">$</span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;female&quot;</span><span class="p">)],</span>
<span class="w">      </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
</code></pre></div>
 
<figure>
     <img src="../assets/images/day2_5_1.png" width="700"/>
     </figure>
</p>
<h2 id="exercise-3-beetle">Exercise 3: beetle</h2>
<p>The third example of a binomial response considers an experiment where beetles were exposed
to carbon disulphide at various concentrations, and the number of beetles who died within five
hours were recorded. The data set is studied in the book by Dobson (2002), and comes originally
from Bliss (1935).
<div class="highlight"><pre><span></span><code><span class="n">beetles</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">dose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1.6907</span><span class="p">,</span><span class="w"> </span><span class="m">1.7242</span><span class="p">,</span><span class="w"> </span><span class="m">1.7552</span><span class="p">,</span><span class="w"> </span><span class="m">1.7842</span><span class="p">,</span><span class="w"> </span><span class="m">1.8113</span><span class="p">,</span><span class="w"> </span><span class="m">1.8369</span><span class="p">,</span><span class="w"> </span><span class="m">1.861</span><span class="p">,</span><span class="w"> </span><span class="m">1.8839</span><span class="p">),</span><span class="w"> </span>
<span class="w">                      </span><span class="n">dead</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">13</span><span class="p">,</span><span class="w"> </span><span class="m">18</span><span class="p">,</span><span class="w"> </span><span class="m">28</span><span class="p">,</span><span class="w"> </span><span class="m">52</span><span class="p">,</span><span class="w"> </span><span class="m">53</span><span class="p">,</span><span class="w"> </span><span class="m">61</span><span class="p">,</span><span class="w"> </span><span class="m">60</span><span class="p">),</span><span class="w"> </span>
<span class="w">                      </span><span class="n">alive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">51</span><span class="p">,</span><span class="w"> </span><span class="m">47</span><span class="p">,</span><span class="w"> </span><span class="m">44</span><span class="p">,</span><span class="w"> </span><span class="m">28</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span>
</code></pre></div></p>
<ol>
<li>Fit a logistic regression to the data using dose as a predictor</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">glm.beetles</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">alive</span><span class="p">,</span><span class="w"> </span><span class="n">dead</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">beetles</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;binomial&quot;</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">glm.beetles</span><span class="p">)</span>
</code></pre></div>
<ol start="2">
<li>Fit another logistic regression using the log-log link. Compare the two fits.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">glm.beetles.log</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">alive</span><span class="p">,</span><span class="w"> </span><span class="n">dead</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">dose</span><span class="p">,</span><span class="w"> </span><span class="n">beetles</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">binomial</span><span class="p">(</span><span class="n">cloglog</span><span class="p">))</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">glm.beetles.log</span><span class="p">)</span>
</code></pre></div>
<ol start="3">
<li>Compare the predictions of each model</li>
</ol>
<p><div class="highlight"><pre><span></span><code><span class="n">new_beetle</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">dose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.9</span><span class="p">,</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">))</span>
<span class="nf">plot</span><span class="p">(</span><span class="nf">predict</span><span class="p">(</span><span class="n">glm.beetles</span><span class="p">,</span><span class="w"> </span><span class="n">new_beetle</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;response&quot;</span><span class="p">),</span><span class="n">ylab</span><span class="o">=</span><span class="s">&quot;response&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;l&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="nf">predict</span><span class="p">(</span><span class="n">glm.beetles.log</span><span class="p">,</span><span class="w"> </span><span class="n">new_beetle</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;response&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">)</span>
</code></pre></div>
 
<figure>
     <img src="../assets/images/day2_6_1.png" width="700"/>
     </figure>
</p>
<h2 id="exercise-4-pima">Exercise 4: Pima</h2>
<p>The national institute of Diabetes and digestive and kidney diseases conducted a study
on 768 adult female Pima Indians living near Phoenix. The purpose of the study was to
investigate the factors related to diabetes.
pregnant: number of times pregnant
glucose: plasma glucose concentration at 2 hours in an oral glucose tolerance test
diastolic: diastolic blood pressure (mm Hg)
triceps: triceps skin fold thickness (mm)
insulin: 2-Hour serum insulin (mu U/ml)
bmi: body mass index (weight in kg/(height in metres squared))
diabetes: diabetes pedigree function (scores likelihood of diabetes based on family history)
age: age (years)
test: test whether the patient shows signs of diabetes (0: negative, 1: positive)
<div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">faraway</span><span class="p">)</span>
<span class="nf">data</span><span class="p">(</span><span class="s">&quot;pima&quot;</span><span class="p">)</span>
</code></pre></div></p>
<ol>
<li>Perform a simple graphical and numerical inspection of the dataset. 
 Can you find any obvious irregularities in the data ? 
If you do, use the appropriate strategy to correct the problems</li>
</ol>
<p><div class="highlight"><pre><span></span><code><span class="nf">str</span><span class="p">(</span><span class="n">pima</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">pima</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">pima</span><span class="o">$</span><span class="n">glucose</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">pima</span><span class="o">$</span><span class="n">glucose</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span>
<span class="n">pima</span><span class="o">$</span><span class="n">diastolic</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">pima</span><span class="o">$</span><span class="n">diastolic</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span>
<span class="n">pima</span><span class="o">$</span><span class="n">triceps</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">pima</span><span class="o">$</span><span class="n">triceps</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span>
<span class="n">pima</span><span class="o">$</span><span class="n">insulin</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">pima</span><span class="o">$</span><span class="n">insulin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span>
<span class="n">pima</span><span class="o">$</span><span class="n">bmi</span><span class="p">[</span><span class="n">pima</span><span class="o">$</span><span class="n">bmi</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span>

<span class="n">pima</span><span class="o">$</span><span class="n">test</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">factor</span><span class="p">(</span><span class="n">pima</span><span class="o">$</span><span class="n">test</span><span class="p">)</span>
<span class="nf">levels</span><span class="p">(</span><span class="n">pima</span><span class="o">$</span><span class="n">test</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;negative&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;positive&quot;</span><span class="p">)</span>
<span class="nf">table</span><span class="p">(</span><span class="n">pima</span><span class="o">$</span><span class="n">test</span><span class="p">)</span>

<span class="nf">boxplot</span><span class="p">(</span><span class="n">pima</span><span class="o">$</span><span class="n">diastolic</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pima</span><span class="o">$</span><span class="n">test</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">(</span><span class="n">pima</span><span class="o">$</span><span class="n">pregnant</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pima</span><span class="o">$</span><span class="n">test</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">(</span><span class="n">pima</span><span class="o">$</span><span class="n">glucose</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pima</span><span class="o">$</span><span class="n">test</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">(</span><span class="n">pima</span><span class="o">$</span><span class="n">triceps</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pima</span><span class="o">$</span><span class="n">test</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">(</span><span class="n">pima</span><span class="o">$</span><span class="n">insulin</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pima</span><span class="o">$</span><span class="n">test</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">(</span><span class="n">pima</span><span class="o">$</span><span class="n">bmi</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pima</span><span class="o">$</span><span class="n">test</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">(</span><span class="n">pima</span><span class="o">$</span><span class="n">diabetes</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pima</span><span class="o">$</span><span class="n">test</span><span class="p">)</span>
<span class="nf">boxplot</span><span class="p">(</span><span class="n">pima</span><span class="o">$</span><span class="n">age</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">pima</span><span class="o">$</span><span class="n">test</span><span class="p">)</span>
</code></pre></div></p>
<ol start="2">
<li>Fit a model with the result of the diabetes test as the response and all the 
other variables as predictors. Can you tell whether this model fits the data ?</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">glm.pima.full</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="n">test</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">pima</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binomial</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">glm.pima.full</span><span class="p">)</span>

<span class="nf">library</span><span class="p">(</span><span class="n">car</span><span class="p">)</span>
<span class="nf">residualPlots</span><span class="p">(</span><span class="n">glm.pima.full</span><span class="p">)</span>

<span class="nf">library</span><span class="p">(</span><span class="n">statmod</span><span class="p">)</span>
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">qresiduals</span><span class="p">(</span><span class="n">glm.pima.full</span><span class="p">))</span>
<span class="nf">qqline</span><span class="p">(</span><span class="nf">qresiduals</span><span class="p">(</span><span class="n">glm.pima.full</span><span class="p">))</span>
<span class="n">qres</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">qresiduals</span><span class="p">(</span><span class="n">glm.pima.full</span><span class="p">)</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">qres</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">glm.pima.full</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;link&quot;</span><span class="p">))</span>
<span class="nf">acf</span><span class="p">(</span><span class="n">qres</span><span class="p">)</span>
</code></pre></div>
<p>The fit is quite good. The residuals are good and the uniform residuals pass all the checks.
There are many non-significant variables so we can remove them to have a better fit.</p>
<ol start="3">
<li>On the basis of the previous result, try to fit another model</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">glm.pima</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="n">test</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">glucose</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bmi</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">diabetes</span><span class="p">,</span><span class="w"> </span><span class="n">pima</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">binomial</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">glm.pima</span><span class="p">)</span>

<span class="nf">residualPlots</span><span class="p">(</span><span class="n">glm.pima</span><span class="p">)</span>
<span class="nf">qqnorm</span><span class="p">(</span><span class="nf">qresiduals</span><span class="p">(</span><span class="n">glm.pima</span><span class="p">))</span>
<span class="nf">qqline</span><span class="p">(</span><span class="nf">qresiduals</span><span class="p">(</span><span class="n">glm.pima</span><span class="p">))</span>
<span class="n">qres</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">qresiduals</span><span class="p">(</span><span class="n">glm.pima</span><span class="p">)</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">qres</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">glm.pima</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;link&quot;</span><span class="p">))</span>
<span class="nf">acf</span><span class="p">(</span><span class="n">qres</span><span class="p">)</span>

<span class="nf">influenceIndexPlot</span><span class="p">(</span><span class="n">glm.pima</span><span class="p">,</span><span class="w"> </span><span class="n">vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Cook&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Studentized&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hat&quot;</span><span class="p">))</span>
</code></pre></div>
<ol start="4">
<li>Using the previous model, predict the outcome for a woman with the following predictor values:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">new_pima</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">pregnant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">glucose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">99</span><span class="p">,</span><span class="w"> </span><span class="n">diastolic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">64</span><span class="p">,</span><span class="w"> </span><span class="n">triceps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">22</span><span class="p">,</span>
<span class="w">                       </span><span class="n">insulin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">76</span><span class="p">,</span><span class="w"> </span><span class="n">bmi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">27</span><span class="p">,</span><span class="w"> </span><span class="n">diabetes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.25</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">25</span><span class="p">)</span>
<span class="n">pred_prob</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">glm.pima</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_pima</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;response&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>

<span class="n">pred_prob</span><span class="o">$</span><span class="n">fit</span><span class="w"> </span>

<span class="n">pred_logit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="n">glm.pima</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_pima</span><span class="p">,</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>

<span class="nf">ilogit</span><span class="p">(</span><span class="n">pred_logit</span><span class="o">$</span><span class="n">fit</span><span class="p">)</span><span class="w"> </span>
<span class="nf">ilogit</span><span class="p">(</span><span class="n">pred_logit</span><span class="o">$</span><span class="n">fit</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1.96</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pred_logit</span><span class="o">$</span><span class="n">se.fit</span><span class="p">)</span>
<span class="nf">ilogit</span><span class="p">(</span><span class="n">pred_logit</span><span class="o">$</span><span class="n">fit</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1.96</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pred_logit</span><span class="o">$</span><span class="n">se.fit</span><span class="p">)</span>
</code></pre></div>
<h2 id="exercise-5-lung-cancer">Exercise 5: lung cancer</h2>
<p>Here we will consider a data set from the ISwR package, which contains the number of
lung cancer cases recorded in different age categories in four different Danish cities.
The cases column contains the number of lung cancer cases for each city and age category.</p>
<div class="highlight"><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">ISwR</span><span class="p">)</span>
<span class="nf">data</span><span class="p">(</span><span class="n">eba1977</span><span class="p">)</span>
<span class="n">eba1977</span>
</code></pre></div>
<ol>
<li>Model this count using the city and age category as predictors.</li>
</ol>
<p>Fit a Poisson GLM to the data. Is the fit appropriate ?</p>
<div class="highlight"><pre><span></span><code><span class="n">glm.cancer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="n">cases</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eba1977</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poisson</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">glm.cancer</span><span class="p">)</span>
</code></pre></div>
<ol start="2">
<li>
<p>In the previous model, we are not considering the number of potential cases in each group 
(i.e. the population size). Modify the model by using an offset which takes the population size into account.
<div class="highlight"><pre><span></span><code><span class="n">glm.cancer.off</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="n">cases</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">offset</span><span class="p">(</span><span class="nf">log</span><span class="p">(</span><span class="n">pop</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eba1977</span><span class="p">,</span>
<span class="w">                      </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poisson</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">glm.cancer.off</span><span class="p">)</span>
</code></pre></div></p>
</li>
<li>
<p>Fit a binomial model to the data by considering success as being lung cancer cases and failures as being: populationsize - number of cases.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">success</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">eba1977</span><span class="o">$</span><span class="n">cases</span>
<span class="n">failures</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">eba1977</span><span class="o">$</span><span class="n">pop</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">eba1977</span><span class="o">$</span><span class="n">cases</span>
<span class="n">glm.cancer.bin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">success</span><span class="p">,</span><span class="w"> </span><span class="n">failures</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;binomial&quot;</span><span class="p">,</span>
<span class="w">                      </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eba1977</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">glm.cancer.bin</span><span class="p">)</span>
</code></pre></div>
<ol start="4">
<li>Compare with the Poisson model.</li>
</ol>
<p>We see that the results are very close to those obtained with the Poisson model with offset.
This is because the number of cases is generally very low compared to the population size,
in other words, the population size is almost infinite compared to the number of cases. In
this situation, the Poisson distribution is closely related to the binomial distribution.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>